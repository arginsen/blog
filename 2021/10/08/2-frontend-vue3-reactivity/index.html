<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="google-site-verification" content="OcsZXBpQqAp8163-20wn3epncmCv_UBtqBLZmspy-NA">
  
  <title>ğŸ”¥ å‰ç«¯ | vue3 å“åº”å¼å­¦ä¹  | Arginsen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="FrontendVue">
  
  
  
  
  <meta name="keywords" content="Frontend,Vue">
<meta property="og:type" content="article">
<meta property="og:title" content="ğŸ”¥ å‰ç«¯ | vue3 å“åº”å¼å­¦ä¹ ">
<meta property="og:url" content="https://lixupeng.cn/blog/2021/10/08/2-frontend-vue3-reactivity/index.html">
<meta property="og:site_name" content="Arginsen&#39;s Blog">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://lixupeng.cn/blog/img/vue.jpg">
<meta property="og:updated_time" content="2025-07-31T17:49:18.300Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ğŸ”¥ å‰ç«¯ | vue3 å“åº”å¼å­¦ä¹ ">
<meta name="twitter:image" content="https://lixupeng.cn/blog/img/vue.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Arginsen&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/blog/css/images/favicon.ico">
  
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="https://fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/blog/css/style.css">

  <script src="/blog/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/blog/css/bootstrap.css">
  <link rel="stylesheet" href="/blog/css/fashion.css">
  <link rel="stylesheet" href="/blog/css/glyphs.css">

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  



<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/blog/" title="Arginsen&#39;s Blog" rel="home"> Arginsen&#39;s Blog </a>
            
          </h1>
          
          
            <div class="site-description">smells like teen spirit</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/">é¦–é¡µ</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/archives">å½’æ¡£</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/categories">åˆ†ç±»</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/about">å…³äº</a> </li>
                    
              </ul>
            </div>
          </nav>
      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-2-frontend-vue3-reactivity" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/blog/img/vue.jpg" rel="gallery_cmeclz8jl00nxmtpufrehqfk6">
        <img src="/blog/img/vue.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ğŸ”¥ å‰ç«¯ | vue3 å“åº”å¼å­¦ä¹ 
    </h1>
  

      </header>
    

    <div class="article-entry" itemprop="articleBody">
      
        <p><br><br><a id="more"></a></p>
<h1 id="å®ç°å“åº”å¼"><a href="#å®ç°å“åº”å¼" class="headerlink" title="å®ç°å“åº”å¼"></a>å®ç°å“åº”å¼</h1><h2 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h2><p>ä¸º JavaScript å¯¹è±¡åˆ›å»ºå“åº”å¼çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ reactive æ–¹æ³•</p>
<p>reactive æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªç»ç”± Proxy ä»£ç†çš„ proxy å¯¹è±¡</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”å¼çŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">  count: <span class="number">0</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p>å¦‚æœé’ˆå¯¹åŸå§‹å€¼è½¬å˜ä¸ºå“åº”å¼ï¼Œå¯ä»¥ä½¿ç”¨ ref ï¼Œå…¶å†…ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªç›¸åŒå€¼çš„ property å¯¹è±¡ï¼Œå°†å…¶ä¼ ç»™ reactive è¿›è¡Œå“åº”å¼åŒ–ï¼Œä¹‹åè¿”å›ä¸€ä¸ªå¯å˜çš„å“åº”å¼å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä½œä¸ºä¸€ä¸ªå“åº”å¼çš„å¼•ç”¨ç»´æŠ¤ç€å®ƒå†…éƒ¨çš„å€¼ã€‚æœ€åæˆ‘ä»¬ç”¨è¯¥å¯¹è±¡çš„ value å±æ€§è¯»å–åŸæ¥çš„å€¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(count.value) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<h3 id="è§£åŒ…"><a href="#è§£åŒ…" class="headerlink" title="è§£åŒ…"></a>è§£åŒ…</h3><ol>
<li>å½“ ref ä½œä¸ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä¸Šçš„ property è¿”å›å¹¶åœ¨æ¨¡æ¿ä½¿ç”¨æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨æµ…å±‚æ¬¡è§£åŒ…å†…éƒ¨å€¼ï¼Œåœ¨è®¿é—®åµŒå¥—çš„ ref æ—¶åˆ™éœ€è¦å†è¿½åŠ  value</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"count ++"</span>&gt;</span>Increment count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"nested.count.value ++"</span>&gt;</span>Nested Increment count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    setup() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> count = ref(<span class="number">0</span>)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        count, <span class="comment">// ç›´æ¥è®¿é—®</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        nested: &#123; <span class="comment">// åµŒå¥—</span></span></span><br><span class="line">          count</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>å½“ ref ä½œä¸ºå“åº”å¼å¯¹è±¡çš„ property è¢«è®¿é—®æˆ–æ›´æ”¹æ—¶ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨è§£åŒ…å†…éƒ¨å€¼ï¼Œä¸ç”¨å†™ valueäº†</li>
</ol>
<p>ref è§£åŒ…è¿›å‘ç”Ÿåœ¨è¢«å“åº”å¼ Object åµŒå¥—çš„æ—¶å€™ï¼Œå½“ä» Array æˆ–åŸç”Ÿé›†åˆå¦‚ Map è®¿é—® ref æ—¶ï¼Œä¸ä¼šè¿›è¡Œè§£åŒ…</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> state = reactive(&#123; count &#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(state.count) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå°†æ–°çš„ ref èµ‹å€¼ç»™ç°æœ‰ ref çš„ propertyï¼Œå°†ä¼šæ›¿æ¢æ—§çš„ ref, ä½†ä¸‹æ–¹æœ¬æ¥çš„ count ä½œä¸º ref å€¼å¹¶ä¸æ”¹å˜</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> otherCount = ref(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">state.count = otherCount</span><br><span class="line"><span class="built_in">console</span>.log(state.count) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(count.value) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h2 id="å“åº”å¼çŠ¶æ€çš„è§£æ„"><a href="#å“åº”å¼çŠ¶æ€çš„è§£æ„" class="headerlink" title="å“åº”å¼çŠ¶æ€çš„è§£æ„"></a>å“åº”å¼çŠ¶æ€çš„è§£æ„</h2><p>ç»ç”± reactive åŒ…è£¹çš„å“åº”å¼å¯¹è±¡ï¼Œå¦‚æœç”¨è§£æ„çš„æ–¹å¼å•ç‹¬è·å–å†…éƒ¨å±æ€§æ—¶ï¼Œå±æ€§ä¼šå¤±å»å“åº”å¼ï¼Œä½¿ç”¨å¿…é¡»ç›´æ¥ç”¨å“åº”å¼å¯¹è±¡è¯»å–ã€‚</p>
<p>æˆ–è€…å¯ä»¥ä½¿ç”¨ toRefs å°†å“åº”å¼å¯¹è±¡è½¬æ¢ä¸ºä¸€ç»„ ref å¯¹è±¡ï¼Œè€Œè¿™äº› ref å°†ä¿ç•™ä¸æºå¯¹è±¡çš„å“åº”å¼å…³è”</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, toRefs &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> book = reactive(&#123;</span><br><span class="line">    author: <span class="string">'Evan'</span>,</span><br><span class="line">    year: <span class="string">'2020'</span>,</span><br><span class="line">    title: <span class="string">'Human History'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; author, title &#125; = book <span class="comment">// ä¸¤å±æ€§å¤±å»å“åº”å¼å…³è”</span></span><br><span class="line"><span class="keyword">let</span> &#123; author, title &#125; = toRefs(book) <span class="comment">// ä¾æ—§ä¿æŒå“åº”å¼</span></span><br><span class="line"></span><br><span class="line">title.value = <span class="string">'Animals History'</span></span><br><span class="line"><span class="built_in">console</span>.log(book.title) <span class="comment">// 'Animals History'</span></span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨-readonly-åˆ›å»ºåªè¯»ä¸èƒ½æ›´æ”¹çš„å“åº”å¼å¯¹è±¡"><a href="#ä½¿ç”¨-readonly-åˆ›å»ºåªè¯»ä¸èƒ½æ›´æ”¹çš„å“åº”å¼å¯¹è±¡" class="headerlink" title="ä½¿ç”¨ readonly åˆ›å»ºåªè¯»ä¸èƒ½æ›´æ”¹çš„å“åº”å¼å¯¹è±¡"></a>ä½¿ç”¨ readonly åˆ›å»ºåªè¯»ä¸èƒ½æ›´æ”¹çš„å“åº”å¼å¯¹è±¡</h2><p>åœ¨ reactive æºç é‡Œï¼ŒåŒæ ·å®šä¹‰äº† readonly å‡½æ•°ï¼Œå…¶ä¼šè¿”å› createReactiveObject() åˆ›å»ºçš„å“åº”å¼å¯¹è±¡ï¼Œå…¶ä¸­è¯¥å‡½æ•°ç¬¬äºŒä¸ªå‚æ•° isReadonly æ ‡è®°ä¸º trueï¼Œå› æ­¤ä¼šç”¨ readonlyHandlers è¿”å›åªè¯»çš„ proxy å¯¹è±¡</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, readonly &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> original = reactive(&#123; count: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> copy = readonly(original)</span><br><span class="line"></span><br><span class="line">original.count++</span><br><span class="line">copy.count++ <span class="comment">// è­¦å‘Š: "Set operation on key 'count' failed:</span></span><br></pre></td></tr></table></figure>
<h2 id="è®¡ç®—å€¼"><a href="#è®¡ç®—å€¼" class="headerlink" title="è®¡ç®—å€¼"></a>è®¡ç®—å€¼</h2><p>computed å‡½æ•°æ¥æ”¶ getter å‡½æ•°å¹¶ä¸º getter è¿”å›å€¼è¿”å›ä¸€ä¸ªä¸å¯å˜çš„å“åº”å¼ ref å¯¹è±¡</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = ref(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> plusOne = computed(<span class="function"><span class="params">()</span> =&gt;</span> count.value + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(plusOne.value) <span class="comment">// 2</span></span><br><span class="line">plusOne.value++ <span class="comment">// error</span></span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–å¯ä»¥æ‰‹åŠ¨å†™å…¥ä¸€ä¸ªåŒ…å« get å’Œ set å‡½æ•°çš„å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå¯å†™çš„ ref å¯¹è±¡</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = ref(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> plusOne = computed(&#123;</span><br><span class="line">    <span class="keyword">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> count.value + <span class="number">1</span>,</span><br><span class="line">    <span class="keyword">set</span>: <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">        count.value = val - <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">plusOne.value <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">plusOne.value = <span class="number">1</span></span><br><span class="line"><span class="built_in">console</span>.log(count.value) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<h2 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h2><p>ç«‹å³æ‰§è¡Œä¼ å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å“åº”å¼è¿½è¸ªå…¶ä¾èµ–ï¼Œå¹¶åœ¨å…¶ä¾èµ–å˜æ›´æ—¶é‡æ–°è¿è¡Œè¯¥å‡½æ•°</p>
<p>ç›®çš„ï¼šæ ¹æ®å“åº”å¼çŠ¶æ€ <strong>è‡ªåŠ¨åº”ç”¨</strong> å’Œ <strong>é‡æ–°åº”ç”¨</strong> å‰¯ä½œç”¨</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(count.value)) <span class="comment">// ç«‹å³æ‰§è¡Œé¦–æ¬¡æ‰“å°</span></span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    count.value++ <span class="comment">// count æ›´æ–°å†æ¬¡è§¦å‘å‡½æ•°</span></span><br><span class="line">&#125;, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<h3 id="åœæ­¢ä¾¦å¬"><a href="#åœæ­¢ä¾¦å¬" class="headerlink" title="åœæ­¢ä¾¦å¬"></a>åœæ­¢ä¾¦å¬</h3><p>å½“ watchEffect åœ¨ç»„ä»¶çš„ setup() å‡½æ•°æˆ–ç”Ÿå‘½å‘¨æœŸé’©å­è¢«è°ƒç”¨æ—¶ï¼Œ ä¾¦å¬å™¨ä¼šè¢«é“¾æ¥åˆ°è¯¥ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢ã€‚</p>
<p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥æ˜¾å¼è°ƒç”¨è¿”å›å€¼ä»¥åœæ­¢ä¾¦å¬ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> linsen = watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨è¿”å›å€¼åœæ­¢</span></span><br><span class="line">linsen()</span><br></pre></td></tr></table></figure>
<h3 id="æ¸…é™¤å‰¯ä½œç”¨"><a href="#æ¸…é™¤å‰¯ä½œç”¨" class="headerlink" title="æ¸…é™¤å‰¯ä½œç”¨"></a>æ¸…é™¤å‰¯ä½œç”¨</h3><p>æœ‰æ—¶å‰¯ä½œç”¨å‡½æ•°ä¼šæ‰§è¡Œä¸€äº›å¼‚æ­¥çš„å‰¯ä½œç”¨ï¼Œè¿™äº›å“åº”éœ€è¦åœ¨å…¶å¤±æ•ˆæ—¶æ¸…é™¤ï¼ˆè¾¾æˆå®Œæˆæ¡ä»¶ï¼‰ï¼Œæ‰€ä»¥ä¾¦å¬å‰¯ä½œç”¨ä¼ å…¥çš„å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ª onInvalidate å‡½æ•°ä½œå…¥å‚ï¼Œç”¨æ¥æ³¨å†Œæ¸…ç†å¤±æ•ˆæ—¶çš„å›è°ƒã€‚</p>
<p>onInvalidate å‡½æ•°ä¼šåœ¨å‰¯ä½œç”¨å³å°†é‡æ–°æ‰§è¡Œæ—¶ã€ä¾¦å¬å™¨è¢«åœæ­¢ (å¦‚æœåœ¨ <code>setup()</code> æˆ–ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­ä½¿ç”¨äº† watchEffectï¼Œåˆ™åœ¨ç»„ä»¶å¸è½½æ—¶) è§¦å‘</p>
<p>ä¹‹æ‰€ä»¥æ˜¯é€šè¿‡ä¼ å…¥ä¸€ä¸ªå‡½æ•°å»æ³¨å†Œå¤±æ•ˆå›è°ƒï¼Œè€Œä¸æ˜¯ä»å›è°ƒè¿”å›å®ƒï¼Œæ˜¯å› ä¸ºè¿”å›å€¼å¯¹äºå¼‚æ­¥é”™è¯¯å¤„ç†å¾ˆé‡è¦</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">watchEffect(<span class="function"><span class="params">onInvalidate</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = performAsyncOperation(id.value)</span><br><span class="line">  onInvalidate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    token.cancel()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº"><a href="#å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº" class="headerlink" title="å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº"></a>å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº</h3><p>vue çš„å“åº”å¼ç³»ç»Ÿä¼šç¼“å­˜å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶å¼‚æ­¥åœ°è¿›è¡Œåˆ·æ–°ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨åŒä¸€ä¸ª tick ä¸­å¤šä¸ªçŠ¶æ€æ”¹å˜å¯¼è‡´çš„ä¸å¿…è¦çš„é‡å¤è°ƒç”¨ã€‚</p>
<p>ç»„ä»¶çš„ update å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªè¢«ä¾¦å¬çš„å‰¯ä½œç”¨ï¼Œå½“ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°è¿›å…¥é˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤ä¼šåœ¨æ‰€æœ‰ç»„ä»¶ update å‰</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  setup() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> count = ref(<span class="number">0</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(count.value) <span class="comment">// åœ¨åˆå§‹è¿è¡Œæ—¶ä¼šåŒæ­¥æ‰“å°ï¼Œcount æ›´æ”¹æ—¶ï¼Œå…ˆäºç»„ä»¶æ›´æ–°è¢«æ‰§è¡Œ</span></span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// ç»™ watchEffect ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼šé™„åŠ çš„ option å¯¹è±¡é…ç½® flush</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// pre å³æ˜¯åœ¨ç»„ä»¶æ›´æ–°å‰æ‰§è¡Œï¼Œpost å³ä¸ºåœ¨æ›´æ–°åæ‰§è¡Œ</span></span></span><br><span class="line">    watchEffect(</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">/* ... */</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line"><span class="javascript">        flush: <span class="string">'post'</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p>watch éœ€è¦ä¾¦å¬ç‰¹å®šçš„æ•°æ®æºï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œå‰¯ä½œç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æƒ°æ€§çš„ï¼Œå³åªæœ‰å½“è¢«ä¾¦å¬çš„æºå‘ç”Ÿå˜åŒ–æ—¶æ‰æ‰§è¡Œå›è°ƒ</p>
<p>ä¸ watchEffect ç›¸æ¯”ï¼Œwatch ï¼š</p>
<ol>
<li>æ‡’æ‰§è¡Œå‰¯ä½œç”¨</li>
<li>æ›´å…·ä½“åœ°è¯´æ˜ä»€ä¹ˆçŠ¶æ€åº”è¯¥è§¦å‘ä¾¦å¬å™¨é‡æ–°è¿è¡Œ</li>
<li>è®¿é—®ä¾¦å¬çŠ¶æ€å˜åŒ–å‰åçš„å€¼</li>
</ol>
<p>æ­¤å¤– watch ä¸ watchEffect å…±äº«ç€æ­¤ç±»è¡Œä¸ºï¼šåœæ­¢ä¾¦å¬ã€æ¸…é™¤å‰¯ä½œç”¨ï¼ˆç›¸åº” onInvalidate ä¼šä½œä¸ºå›è°ƒçš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ watchï¼‰ã€å‰¯ä½œç”¨åˆ·æ–°æ—¶æœºã€ä¾¦å¬å™¨è°ƒè¯•</p>
<h3 id="ä¾¦å¬å•ä¸ªæ•°æ®æº"><a href="#ä¾¦å¬å•ä¸ªæ•°æ®æº" class="headerlink" title="ä¾¦å¬å•ä¸ªæ•°æ®æº"></a>ä¾¦å¬å•ä¸ªæ•°æ®æº</h3><p>ä¾¦å¬å™¨æ•°æ®æºå¯ä»¥æ˜¯è¿”å›å€¼çš„ getter å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ˜¯ ref</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾¦å¬ä¸€ä¸ª getter</span></span><br><span class="line"><span class="keyword">const</span> state = reactive(&#123; count: <span class="number">0</span> &#125;)</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; state.count,</span><br><span class="line">  (count, prevCount) =&gt; &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥ä¾¦å¬ref</span></span><br><span class="line"><span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line">watch(count, <span class="function">(<span class="params">count, prevCount</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="ä¾¦å¬å¤šä¸ªæ•°æ®æº"><a href="#ä¾¦å¬å¤šä¸ªæ•°æ®æº" class="headerlink" title="ä¾¦å¬å¤šä¸ªæ•°æ®æº"></a>ä¾¦å¬å¤šä¸ªæ•°æ®æº</h3><p>ä¾¦å¬å™¨å¯ä»¥ä½¿ç”¨æ•°ç»„åŒæ—¶ä¾¦å¬å¤šä¸ªæº</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstName = ref(<span class="string">''</span>)</span><br><span class="line"><span class="keyword">const</span> lastName = ref(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">watch([firstName, lastName], <span class="function">(<span class="params">newValues, prevValues</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValues, prevValues)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">firstName.value = <span class="string">'John'</span> <span class="comment">// logs: ["John", ""] ["", ""]</span></span><br><span class="line">lastName.value = <span class="string">'Smith'</span> <span class="comment">// logs: ["John", "Smith"] ["John", ""]</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¾¦å¬å“åº”å¼å¯¹è±¡"><a href="#ä¾¦å¬å“åº”å¼å¯¹è±¡" class="headerlink" title="ä¾¦å¬å“åº”å¼å¯¹è±¡"></a>ä¾¦å¬å“åº”å¼å¯¹è±¡</h3><p>ä½¿ç”¨ä¾¦å¬å™¨æ¥æ¯”è¾ƒä¸€ä¸ªæ•°ç»„æˆ–å¯¹è±¡çš„å€¼ï¼Œè¿™äº›å€¼æ˜¯å“åº”å¼çš„ï¼Œè¦æ±‚å®ƒæœ‰ä¸€ä¸ªç”±å€¼æ„æˆçš„å‰¯æœ¬</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = reactive([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; [...numbers],</span><br><span class="line">  (numbers, prevNumbers) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(numbers, prevNumbers)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">numbers.push(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>å°è¯•æ£€æŸ¥æ·±åº¦åµŒå¥—å¯¹è±¡æˆ–æ•°ç»„ä¸­çš„ property å˜åŒ–æ—¶ï¼Œéœ€è¦ deep é€‰é¡¹è®¾ç½®ä¸º trueï¼Œä½†æ˜¯å¯ä»¥è¯»å–åˆ°å€¼å¹¶ä¸èƒ½ä¾¦å¬åˆ°å˜åŒ–ã€‚å› ä¸ºåœ¨ä¾¦å¬å“åº”å¼å¯¹è±¡æˆ–æ•°ç»„å°†å§‹ç»ˆè¿”å›è¯¥å¯¹è±¡çš„å½“å‰å€¼å’Œä¸Šä¸€ä¸ªçŠ¶æ€å€¼çš„å¼•ç”¨ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  attributes: &#123;</span><br><span class="line">    name: <span class="string">''</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; state,</span><br><span class="line">  (state, prevState) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'deep'</span>, state.attributes.name, prevState.attributes.name)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; deep: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">state.attributes.name = <span class="string">'Alex'</span> <span class="comment">// "deep" "Alex" "Alex"</span></span><br></pre></td></tr></table></figure>
<p>æƒ³è¦å®Œå…¨ä¾¦å¬æ·±åº¦åµŒå¥—çš„å¯¹è±¡å’Œæ•°ç»„ï¼Œå¯èƒ½éœ€è¦å¯¹å€¼è¿›è¡Œæ·±æ‹·è´ã€‚å¯ä»¥é€šè¿‡ lodash.cloneDeep å·¥å…·å‡½æ•°å®ç°</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  attributes: &#123;</span><br><span class="line">    name: <span class="string">''</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  () =&gt; _.cloneDeep(state),</span><br><span class="line">  (sate, prevState) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(state.attributes.name, prevState.attributes.name)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">state.attributes.name = <span class="string">'Alex'</span> <span class="comment">// æ—¥å¿—: "Alex" ""</span></span><br></pre></td></tr></table></figure>
<h1 id="å“åº”å¼åŸç†"><a href="#å“åº”å¼åŸç†" class="headerlink" title="å“åº”å¼åŸç†"></a>å“åº”å¼åŸç†</h1><p>vue3 çš„å“åº”å¼ç³»ç»Ÿæ”¾åœ¨ package ä¸‹çš„ reactivity ç›®å½•ã€‚</p>
<p>reactivity å•ç‹¬ä½œä¸ºä¸€ä¸ªåŒ…å­˜åœ¨ï¼Œæ˜¯å†…åµŒåˆ° vue æ¸²æŸ“å™¨ä¸­ï¼Œå®ƒä¹Ÿå¯ä»¥å•ç‹¬å‘å¸ƒæˆ–è€…è¢«ç¬¬ä¸‰æ–¹å¼•ç”¨ã€‚</p>
<p>reactivity çš„ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ __tests__  <span class="comment">// å•å…ƒæµ‹è¯•ç›®å½•</span></span><br><span class="line">â”‚   â”œâ”€â”€ collections</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ Map.spec.ts</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ Set.spec.ts</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ WeakMap.spec.ts</span><br><span class="line">â”‚   â”‚   â””â”€â”€ WeakSet.spec.ts</span><br><span class="line">â”‚   â”œâ”€â”€ computed.spec.ts</span><br><span class="line">â”‚   â”œâ”€â”€ effect.spec.ts</span><br><span class="line">â”‚   â”œâ”€â”€ reactive.spec.ts</span><br><span class="line">â”‚   â”œâ”€â”€ reactiveArray.spec.ts</span><br><span class="line">â”‚   â”œâ”€â”€ readonly.spec.ts</span><br><span class="line">â”‚   â””â”€â”€ ref.spec.ts</span><br><span class="line">â”œâ”€â”€ api-extractor.json</span><br><span class="line">â”œâ”€â”€ index.js</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â”œâ”€â”€ baseHandlers.ts <span class="comment">// åŸºæœ¬ç±»å‹çš„å¤„ç†å™¨</span></span><br><span class="line">    â”œâ”€â”€ collectionHandlers.ts  <span class="comment">// Set Map WeakSet WeckMapçš„å¤„ç†å™¨</span></span><br><span class="line">    â”œâ”€â”€ computed.ts <span class="comment">// è®¡ç®—å±æ€§ï¼ŒåŒ Vue2</span></span><br><span class="line">    â”œâ”€â”€ DeferredComputed.ts </span><br><span class="line">    â”œâ”€â”€ dep.ts </span><br><span class="line">    â”œâ”€â”€ effect.ts <span class="comment">// reactive æ ¸å¿ƒï¼Œå¤„ç†ä¾èµ–æ”¶é›†ï¼Œä¾èµ–æ›´æ–°</span></span><br><span class="line">    â”œâ”€â”€ effectScope.ts <span class="comment">// effect ä½œç”¨åŸŸå¯¹è±¡ï¼Œç”¨ä»¥æ•è·åœ¨å…¶å†…éƒ¨åˆ›å»ºçš„å“åº”å¼ effect</span></span><br><span class="line">    â”œâ”€â”€ index.ts</span><br><span class="line">    â”œâ”€â”€ operations.ts <span class="comment">// å®šä¹‰ä¾èµ–æ”¶é›†ï¼Œä¾èµ–æ›´æ–°çš„ç±»å‹</span></span><br><span class="line">    â”œâ”€â”€ reactive.ts <span class="comment">// reactive å…¥å£ï¼Œå†…éƒ¨ä¸»è¦ä»¥ Proxy å®ç°</span></span><br><span class="line">    â”œâ”€â”€ ref.ts <span class="comment">// Proxy å¤„ç†ä¸äº†åŸºç¡€å€¼ç±»å‹çš„å“åº”ï¼ŒRef æ¥å¤„ç†</span></span><br><span class="line">    â””â”€â”€ warning.ts <span class="comment">// å®šä¹‰ä¸€ä¸ª warn çš„æ–¹æ³•ç”¨ä»¥æŠ›å‡º vue è­¦å‘Š</span></span><br></pre></td></tr></table></figure>
<h2 id="reactive-1"><a href="#reactive-1" class="headerlink" title="reactive"></a>reactive</h2><p>é€šå¸¸æˆ‘ä»¬åœ¨ setup() ä¸­ä½¿ç”¨ reactive æ¥åˆ›å»ºå“åº”å¼å¯¹è±¡</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> defineComponent(&#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> obj = reactive(&#123;</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      obj</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>reactive çš„å®ç°æ˜¯ç”± proxy å’Œ effect ç»„åˆå½¢æˆçš„</p>
<p>å¯¹ä¼ å…¥çš„å¯¹è±¡ä½œä»¥ç­›é€‰è¿‡æ»¤ï¼Œå·²æœ‰ã€ä¸ç¬¦åˆçš„ç›´æ¥è¿”å›ç›®æ ‡ï¼Œå¦åˆ™æ–°å»ºä¸€ä¸ªä»£ç†</p>
<p>é™¤ reactive å®šä¹‰å¤–, è¿˜æœ‰ readonly(åªè¯»çš„å“åº”å¼å¯¹è±¡ä»£ç†), æµ…å±‚çš„ä»£ç† shallow, æµç¨‹æ˜¯ä¸€æ ·çš„</p>
<p>reactive å‡½æ•°æ¥æ”¶ä¸€ä¸ªå¾…å“åº”å¼åŒ–çš„å¯¹è±¡, å¦‚æœä¼ å…¥çš„å¯¹è±¡å­˜åœ¨ä¸”å¯¹è±¡å­˜åœ¨åªè¯»å±æ€§çš„æ ‡è®°, é‚£ä¹ˆå°±ç›´æ¥è¿”å›è¯¥å¯¹è±¡, è¯´æ˜è¯¥å¯¹è±¡æ˜¯ç»è¿‡ readonly() å“åº”å¼åŒ–çš„å¯¹è±¡; è‹¥æ— æ­¤é—®é¢˜, åˆ™è°ƒç”¨ createReactiveObject å‡½æ•°åˆ›å»ºå“åº”å¼å¯¹è±¡</p>
<p>createReactiveObject æ¥æ”¶è¯¥å¯¹è±¡, å¹¶æ ‡è®°æ˜¯å¦æ˜¯ readonly , åŒæ—¶ä¼ å…¥å¯å˜çš„ mutableHandlers, æ­¤handler æ˜¯æä¾›ç»™ Proxy ä»£ç†çš„é…ç½®, æ­¤å¤–ä¹Ÿå­˜åœ¨ readonly, ä»¥åŠæµ…å±‚å¯¹åº”çš„å¤„ç†å™¨; æ­¤å¤–è¿˜æœ‰é’ˆå¯¹ setã€mapã€weakSetã€weakMap æ•°æ®ç»“æ„çš„ collectionHandlers, æœ€åçš„å‚æ•°æ˜¯ reactiveMap, ç”¨äºç¼“å­˜æ ¹æ®å½“å‰çš„ target åˆ›å»ºçš„ proxy å¯¹è±¡çš„ weakMap å¯¹è±¡</p>
<p>createReactiveObject é¦–å…ˆåˆ¤æ–­ä¼ å…¥çš„å€¼æ˜¯å¦ä¸ºå¯¹è±¡, è‹¥ä¸æ˜¯åˆ™è­¦å‘Šè¿”å›ç›®æ ‡; æ¥ç€æ£€æµ‹ä¼ å…¥çš„ target æ˜¯å¦å·²ç»ä¸ºä¸€ä¸ª proxy å¯¹è±¡, å¹¶ä¸”æ’é™¤ä¼ å…¥ readonly çš„ proxy å¯¹è±¡, è¿”å› target æœ¬èº«;</p>
<p>target çš„ proxy å¯¹è±¡æœ‰è¿›è¡Œç¼“å­˜è®¾è®¡, ç»è¿‡ proxy å¤„ç†çš„ target ä¼šè¢«å­˜å…¥ proxyMap, å¦‚æœç¼“å­˜ä¸­å­˜åœ¨, åˆ™ç›´æ¥æå–è¿”å›; </p>
<p>è‹¥æ˜¯ target çš„ type æ— æ•ˆ, ä¹Ÿä¼šè¢«ç›´æ¥è¿”å›</p>
<p>æœ€åç»™ target åˆ›å»º proxy å¯¹è±¡, åˆ¤æ–­ target çš„ç±»å‹æ˜¯å¦ä¸º COLLECTION, ä¹Ÿå°±æ˜¯åˆ¤æ–­æ˜¯å¦ä¸º map set ç­‰æ•°æ®ç±»å‹; æ¥ç»™äºˆä¸åŒçš„ handler; æœ€åå°†åˆ›å»ºçš„ proxyMap ç¼“å­˜</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ weakMap å­˜å‚¨ç›®æ ‡å¯¹è±¡+ç›®æ ‡å¯¹è±¡çš„ä»£ç†</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reactiveMap = <span class="keyword">new</span> WeakMap&lt;Target, <span class="built_in">any</span>&gt;()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> readonlyMap = <span class="keyword">new</span> WeakMap&lt;Target, <span class="built_in">any</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">object</span>&gt;(<span class="params">target: T</span>): <span class="title">UnwrapNestedRefs</span>&lt;<span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target: object</span>) </span>&#123;</span></span><br><span class="line"><span class="function">  // <span class="title">if</span> <span class="title">trying</span> <span class="title">to</span> <span class="title">observe</span> <span class="title">a</span> <span class="title">readonly</span> <span class="title">proxy</span>, <span class="title">return</span> <span class="title">the</span> <span class="title">readonly</span> <span class="title">version</span>.</span></span><br><span class="line"><span class="function">  // å·²ç»è¿‡ <span class="title">readonly</span> å¤„ç†çš„å“åº”å¼å¯¹è±¡ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="function">  <span class="title">if</span> (<span class="params">target &amp;&amp; (target <span class="keyword">as</span> Target)[ReactiveFlags.IS_READONLY]</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> createReactiveObject(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    mutableHandlers,</span><br><span class="line">    mutableCollectionHandlers,</span><br><span class="line">    reactiveMap</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// readonly åˆ›å»ºåªè¯»ä¸èƒ½æ›´æ”¹çš„å“åº”å¼å¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">// è¿”å›çš„åˆ›å»ºå‡½æ•°ç¬¬äºŒä¸ªå‚æ•° isReadonly ä¸º trueï¼Œ</span></span><br><span class="line"><span class="comment">// åŒæ—¶ä¼ ç»™ proxy çš„ handler ä¹Ÿæ˜¯ readonly ä¸“æœ‰çš„</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">readonly</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">object</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  target: T</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">DeepReadonly</span>&lt;<span class="title">UnwrapNestedRefs</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createReactiveObject(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    readonlyHandlers,</span><br><span class="line">    readonlyCollectionHandlers,</span><br><span class="line">    readonlyMap</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createReactiveObject</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  target: Target,</span></span></span><br><span class="line"><span class="function"><span class="params">  isReadonly: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  baseHandlers: ProxyHandler&lt;<span class="built_in">any</span>&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  collectionHandlers: ProxyHandler&lt;<span class="built_in">any</span>&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  proxyMap: WeakMap&lt;Target, <span class="built_in">any</span>&gt;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123; <span class="comment">// å¦‚ä¼ å…¥ç›®æ ‡ä¸æ˜¯å¯¹è±¡ï¼ŒæŠ›å‡ºè­¦å‘Š</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(<span class="string">`value cannot be made reactive: <span class="subst">$&#123;<span class="built_in">String</span>(target)&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// target is already a Proxy, return it.</span></span><br><span class="line">  <span class="comment">// exception: calling readonly() on a reactive object</span></span><br><span class="line">  <span class="comment">// ä¼ å…¥ç›®æ ‡æ˜¯ proxy å¯¹è±¡ï¼Œä¸”ä½¿ç”¨ readonly å¤„ç†å·²ä»£ç†å¯¹è±¡çš„é™¤å¤–ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    target[ReactiveFlags.RAW] &amp;&amp;</span><br><span class="line">    !(isReadonly &amp;&amp; target[ReactiveFlags.IS_REACTIVE])</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// target already has corresponding Proxy</span></span><br><span class="line">  <span class="comment">// ä¼ å…¥ç›®æ ‡å·²å­˜åœ¨ç›¸åŒ¹é…çš„ä»£ç†å¯¹è±¡åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">const</span> existingProxy = proxyMap.get(target)</span><br><span class="line">  <span class="keyword">if</span> (existingProxy) &#123;</span><br><span class="line">    <span class="keyword">return</span> existingProxy</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// only a whitelist of value types can be observed.</span></span><br><span class="line">  <span class="comment">// ä»…æœ‰ä¼ å…¥å€¼ç±»å‹ç™½åå•å†…çš„æ‰å¯ä»¥å“åº”å¼åŒ–ï¼Œæ— æ•ˆç›®æ ‡ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">const</span> targetType = getTargetType(target)</span><br><span class="line">  <span class="keyword">if</span> (targetType === TargetType.INVALID) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ›å»º proxy ä»£ç†</span></span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> Proxy(</span><br><span class="line">    target,</span><br><span class="line">    targetType === TargetType.COLLECTION ? collectionHandlers : baseHandlers</span><br><span class="line">  )</span><br><span class="line">  proxyMap.set(target, proxy)</span><br><span class="line">  <span class="keyword">return</span> proxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯è§ç™½åå•çš„ target æœ‰ Object,Array,Map,Set,WeakMap,WeakSet</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">targetTypeMap</span>(<span class="params">rawType: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (rawType) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Object'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Array'</span>:</span><br><span class="line">      <span class="keyword">return</span> TargetType.COMMON</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Map'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'Set'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'WeakMap'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'WeakSet'</span>:</span><br><span class="line">      <span class="keyword">return</span> TargetType.COLLECTION</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> TargetType.INVALID</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTargetType</span>(<span class="params">value: Target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value[ReactiveFlags.SKIP] || !<span class="built_in">Object</span>.isExtensible(value)</span><br><span class="line">    ? TargetType.INVALID</span><br><span class="line">    : targetTypeMap(toRawType(value))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="baseHandler"><a href="#baseHandler" class="headerlink" title="baseHandler"></a>baseHandler</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h2><h2 id="ref-1"><a href="#ref-1" class="headerlink" title="ref"></a>ref</h2><p>åˆ›å»ºä¸€ä¸ª ref å€¼æ—¶, é»˜è®¤è§‚æµ‹æ˜¯æµ…å±‚çš„, è¿™é‡Œ shallow ä¸º false, æ¥ç€åˆ›å»º RefImpl å®ä¾‹, å°†ä¼ å…¥çš„å€¼ç”¨ toRaw toReactive æ–¹æ³•å¤„ç†;</p>
<p>toRaw æ–¹æ³•é¦–å…ˆåˆ¤æ–­ä¼ å…¥çš„å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªç»è¿‡ reactive å¤„ç†è¿‡åçš„ proxy å¯¹è±¡, å¦‚æœæ˜¯åˆ™ç›´æ¥è¿”å›; å¦‚æœä¸æ˜¯åˆ™å°† raw ä¼ å…¥ toRaw é€’å½’</p>
<p>toReactive æ–¹æ³•åˆ¤æ–­ä¼ å…¥çš„æ˜¯å¦ä¸ºä¸€ä¸ªå¯¹è±¡, å¦‚æœæ˜¯å¯¹è±¡å°±ç”¨ reactive å¤„ç†, å¦‚æœä¸æ˜¯åˆ™ç›´æ¥è¿”å›</p>
<p>åœ¨è·å– ref å¯¹è±¡å€¼æ—¶, è§¦å‘ get() å‡½æ•°, é¦–å…ˆæ”¶é›† trackRefValue ä¾èµ–, å†è¿”å›å½“å‰å¯¹è±¡çš„ this._value å€¼</p>
<p>è¿™é‡Œæ˜¯å¯¹å¤–å¼€æ”¾ value, æä¾›äº† get å’Œ set æ–¹æ³•, æ‰€ä»¥æˆ‘ä»¬è·å– ref å¯¹è±¡åçš„å€¼éœ€è¦ç”¨ value è·å–, ä¹Ÿå°±æ˜¯ <code>ref(100).value</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\reactivity\src\ref.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ref</span>(<span class="params">value?: unknown</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createRef(value, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createRef</span>(<span class="params">rawValue: unknown, shallow: <span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isRef(rawValue)) &#123;</span><br><span class="line">    <span class="keyword">return</span> rawValue</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RefImpl(rawValue, shallow)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> RefImpl&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> _value: T</span><br><span class="line">  <span class="keyword">private</span> _rawValue: T</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> dep?: Dep = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">public</span> readonly __v_isRef = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">value: T, <span class="keyword">public</span> readonly _shallow: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>._rawValue = _shallow ? value : toRaw(value)</span><br><span class="line">    <span class="keyword">this</span>._value = _shallow ? value : toReactive(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> value() &#123;</span><br><span class="line">    trackRefValue(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> value(newVal) &#123;</span><br><span class="line">    newVal = <span class="keyword">this</span>._shallow ? newVal : toRaw(newVal)</span><br><span class="line">    <span class="keyword">if</span> (hasChanged(newVal, <span class="keyword">this</span>._rawValue)) &#123;</span><br><span class="line">      <span class="keyword">this</span>._rawValue = newVal</span><br><span class="line">      <span class="keyword">this</span>._value = <span class="keyword">this</span>._shallow ? newVal : toReactive(newVal)</span><br><span class="line">      triggerRefValue(<span class="keyword">this</span>, newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toRaw</span>&lt;<span class="title">T</span>&gt;(<span class="params">observed: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> raw = observed &amp;&amp; (observed <span class="keyword">as</span> Target)[ReactiveFlags.RAW]</span><br><span class="line">  <span class="keyword">return</span> raw ? toRaw(raw) : observed</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> toReactive = &lt;T <span class="keyword">extends</span> unknown&gt;(value: T): <span class="function"><span class="params">T</span> =&gt;</span></span><br><span class="line">  isObject(value) ? reactive(value) : value</span><br></pre></td></tr></table></figure>
<h2 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h2><p>ä½¿ç”¨ computed å®šä¹‰ä¸€ä¸ªè®¡ç®—å±æ€§</p>
<p>é¦–å…ˆä¼šæ£€æŸ¥ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸ºä¸€ä¸ªå‡½æ•°, ä¸€èˆ¬æˆ‘ä»¬åªä¼šä¼ å…¥ä¸€ä¸ªåŸºäºä¾èµ–å€¼è¿”å›è®¡ç®—å€¼çš„å‡½æ•°, å½“ç„¶ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªå«æœ‰ get ä¸ set çš„å¯¹è±¡, æŒ‡å®šè¯¥è®¡ç®—å±æ€§çš„è¯»å–ä¸èµ‹å€¼, å†å°†å‡½æ•°æå–</p>
<p>æ¥ç€åˆ›å»ºä¸€ä¸ª computedRefImpl å®ä¾‹, æ¯ä¸ªè®¡ç®—å±æ€§ ref å®ä¾‹ä¼šæœ‰è‡ªå·± dep, effect, ä»¥åŠè®¡ç®—å±æ€§ç¼“å­˜ dirty æ ‡è¯†; </p>
<p>åˆå§‹ get è·å–æ—¶ dirty ä¸º true, ä¼šè°ƒç”¨è‡ªèº«çš„ effect è¿›è¡Œè®¡ç®— run, å¾—åˆ°ç»è¿‡è®¡ç®—ä¾èµ–åçš„å€¼, åŒæ—¶å°† dirty è½¬ä¸º false, å…¶ä»–åœ°æ–¹æœ‰è·å–è¯¥è®¡ç®—å±æ€§ ref çš„åœ°æ–¹, ç›´æ¥è¿”å›å½“å‰çš„å€¼; ä¼šç­‰åˆ°å†æ¬¡ä¾èµ–å€¼å˜åŒ–å, è§¦å‘ triggerRefValue, æ‰§è¡Œå‹å…¥ effect çš„å›è°ƒå‡½æ•° scheduler å†æ¬¡ä»¤ dirty ä¸º true</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\reactivity\src\computed.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">computed</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  getterOrOptions: ComputedGetter&lt;T&gt; | WritableComputedOptions&lt;T&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  debugOptions?: DebuggerOptions</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> getter: ComputedGetter&lt;T&gt;</span><br><span class="line">  <span class="keyword">let</span> setter: ComputedSetter&lt;T&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onlyGetter = isFunction(getterOrOptions)</span><br><span class="line">  <span class="keyword">if</span> (onlyGetter) &#123;</span><br><span class="line">    getter = getterOrOptions</span><br><span class="line">    setter = __DEV__</span><br><span class="line">      ? <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.warn(<span class="string">'Write operation failed: computed value is readonly'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      : NOOP</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    getter = getterOrOptions.get</span><br><span class="line">    setter = getterOrOptions.set</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> cRef = <span class="keyword">new</span> ComputedRefImpl(getter, setter, onlyGetter || !setter)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; debugOptions) &#123;</span><br><span class="line">    cRef.effect.onTrack = debugOptions.onTrack</span><br><span class="line">    cRef.effect.onTrigger = debugOptions.onTrigger</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> cRef <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ComputedRefImpl ç±»</span></span><br><span class="line"><span class="keyword">class</span> ComputedRefImpl&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">public</span> dep?: Dep = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> _value!: T</span><br><span class="line">  <span class="keyword">private</span> _dirty = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">public</span> readonly effect: ReactiveEffect&lt;T&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> readonly __v_isRef = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">public</span> readonly [ReactiveFlags.IS_READONLY]: <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    getter: ComputedGetter&lt;T&gt;,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> readonly _setter: ComputedSetter&lt;T&gt;,</span></span><br><span class="line"><span class="params">    isReadonly: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.effect = <span class="keyword">new</span> ReactiveEffect(getter, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>._dirty) &#123;</span><br><span class="line">        <span class="keyword">this</span>._dirty = <span class="literal">true</span></span><br><span class="line">        triggerRefValue(<span class="keyword">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>[ReactiveFlags.IS_READONLY] = isReadonly</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> value() &#123;</span><br><span class="line">    <span class="comment">// the computed ref may get wrapped by other proxies e.g. readonly() #3376</span></span><br><span class="line">    <span class="keyword">const</span> self = toRaw(<span class="keyword">this</span>)</span><br><span class="line">    trackRefValue(self)</span><br><span class="line">    <span class="keyword">if</span> (self._dirty) &#123;</span><br><span class="line">      self._dirty = <span class="literal">false</span></span><br><span class="line">      self._value = self.effect.run()!</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> self._value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> value(newValue: T) &#123;</span><br><span class="line">    <span class="keyword">this</span>._setter(newValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://v3.cn.vuejs.org/guide/reactivity.html" target="_blank" rel="noopener">https://v3.cn.vuejs.org/guide/reactivity.html</a></p>
<p><a href="https://vue3js.cn/vue-composition-api" target="_blank" rel="noopener">https://vue3js.cn/vue-composition-api</a></p>

      
    </div>
    <br>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/blog/categories/notes/">notes</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Frontend/">Frontend</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Vue/">Vue</a></li></ul>

      
	<span class="ico-date"></span>
	<a href="/blog/2021/10/08/2-frontend-vue3-reactivity/" class="article-date">
	  <time datetime="2021-10-08T10:45:00.000Z" itemprop="datePublished">åæœˆ 8, 2021</time>
	</a>

      <!-- æ·»åŠ å­—æ•°ç»Ÿè®¡ -->
      
        <span class="ico-fontcount"></span><span class="post-count">3.9kå­—</span>
      
    </footer>
    <!-- æ–‡ç« æ·»åŠ è¯„è®º -->
    
      
    <script defer src="https://unpkg.com/leancloud-storage@4/dist/av-min.js"></script>
    <script defer src='https://unpkg.com/valine@latest/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>

        var notify = 'false' == true ? true : false;
        var verify = 'false' == true ? true : false;
		// è®¾ç½®è½®è¯¢
		const timer = setInterval(() => {
			if (window.Valine && typeof window.Valine === 'function') {
				clearInterval(timer);
				new Valine({
					el: '#vcomments',
					notify: notify,
					verify: verify,
					app_id: 'AJj6aG4cDMBqBIISAr1U53Az-gzGzoHsz',
					app_key: 'bIYBhlht4PSXI4pCWuH7Gnuo',
					placeholder: 'say something bro ~',
					avatar: 'monsterid',
					avatarCDN:'https://cravatar.cn/avatar/',
					visitor: 'true',
                    emojiCDN: '//i0.hdslb.com/bfs/emote/', 
                    // è¡¨æƒ…titleå’Œå›¾ç‰‡æ˜ å°„
                    emojiMaps: {
                        "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
                        "tv_äº²äº²": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
                        "tv_å·ç¬‘": "bb690d4107620f1c15cff29509db529a73aee261.png",
                        "tv_å†è§": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
                        "tv_å†·æ¼ ": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
                        "tv_å‘æ€’": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
                        "tv_å‘è´¢": "34db290afd2963723c6eb3c4560667db7253a21a.png",
                        "tv_å¯çˆ±": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
                        "tv_åè¡€": "09dd16a7aa59b77baa1155d47484409624470c77.png",
                        "tv_å‘†": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
                        "tv_å‘•å": "9f996894a39e282ccf5e66856af49483f81870f3.png",
                        "tv_å›°": "241ee304e44c0af029adceb294399391e4737ef2.png",
                        "tv_åç¬‘": "1f0b87f731a671079842116e0991c91c2c88645a.png",
                        "tv_å¤§ä½¬": "093c1e2c490161aca397afc45573c877cdead616.png",
                        "tv_å¤§å“­": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
                        "tv_å§”å±ˆ": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
                        "tv_å®³ç¾": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
                        "tv_å°´å°¬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
                        "tv_å¾®ç¬‘": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
                        "tv_æ€è€ƒ": "90cf159733e558137ed20aa04d09964436f618a1.png",
                        "tv_æƒŠå“": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
                        // ... æ›´å¤šè¡¨æƒ…
                    }
				});
			}
		}, 1000);
    </script>



    
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2021/10/10/2-frontend-vue3-source-flow/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          ğŸ”¥ å‰ç«¯ | vue3 æºç å­¦ä¹  - æµç¨‹
        
      </div>
    </a>
  
  
    <a href="/blog/2021/10/03/2-frontend-vite/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">ğŸ”¥ å‰ç«¯ | Vite ä½¿ç”¨</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#å®ç°å“åº”å¼"><span class="nav-number">1.</span> <span class="nav-text">å®ç°å“åº”å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#reactive"><span class="nav-number">1.1.</span> <span class="nav-text">reactive</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ref"><span class="nav-number">1.2.</span> <span class="nav-text">ref</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è§£åŒ…"><span class="nav-number">1.2.1.</span> <span class="nav-text">è§£åŒ…</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å“åº”å¼çŠ¶æ€çš„è§£æ„"><span class="nav-number">1.3.</span> <span class="nav-text">å“åº”å¼çŠ¶æ€çš„è§£æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨-readonly-åˆ›å»ºåªè¯»ä¸èƒ½æ›´æ”¹çš„å“åº”å¼å¯¹è±¡"><span class="nav-number">1.4.</span> <span class="nav-text">ä½¿ç”¨ readonly åˆ›å»ºåªè¯»ä¸èƒ½æ›´æ”¹çš„å“åº”å¼å¯¹è±¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è®¡ç®—å€¼"><span class="nav-number">1.5.</span> <span class="nav-text">è®¡ç®—å€¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#watchEffect"><span class="nav-number">1.6.</span> <span class="nav-text">watchEffect</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åœæ­¢ä¾¦å¬"><span class="nav-number">1.6.1.</span> <span class="nav-text">åœæ­¢ä¾¦å¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¸…é™¤å‰¯ä½œç”¨"><span class="nav-number">1.6.2.</span> <span class="nav-text">æ¸…é™¤å‰¯ä½œç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº"><span class="nav-number">1.6.3.</span> <span class="nav-text">å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#watch"><span class="nav-number">1.7.</span> <span class="nav-text">watch</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¾¦å¬å•ä¸ªæ•°æ®æº"><span class="nav-number">1.7.1.</span> <span class="nav-text">ä¾¦å¬å•ä¸ªæ•°æ®æº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¾¦å¬å¤šä¸ªæ•°æ®æº"><span class="nav-number">1.7.2.</span> <span class="nav-text">ä¾¦å¬å¤šä¸ªæ•°æ®æº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¾¦å¬å“åº”å¼å¯¹è±¡"><span class="nav-number">1.7.3.</span> <span class="nav-text">ä¾¦å¬å“åº”å¼å¯¹è±¡</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å“åº”å¼åŸç†"><span class="nav-number">2.</span> <span class="nav-text">å“åº”å¼åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#reactive-1"><span class="nav-number">2.1.</span> <span class="nav-text">reactive</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#baseHandler"><span class="nav-number">2.2.</span> <span class="nav-text">baseHandler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#effect"><span class="nav-number">2.3.</span> <span class="nav-text">effect</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ref-1"><span class="nav-number">2.4.</span> <span class="nav-text">ref</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#computed"><span class="nav-number">2.5.</span> <span class="nav-text">computed</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">3.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">HOME</a>
  
    <a href="/blog/archives" class="mobile-nav-link">ARCHIVES</a>
  
    <a href="/blog/categories" class="mobile-nav-link">CATEGORIES</a>
  
    <a href="/blog/about" class="mobile-nav-link">ABOUT</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2025 Arginsen&#39;s Blog All Rights Reserved.
      </div>
      <div class="site-credit">
        ID  <a href="https://lixupeng.cn" target="_blank">Arginsen</a>
      </div>
      <br>
      <div class="busuanzi-analytics">
        
        <span id="busuanzi_container_site_pv">
          æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
        </span>
        <span class="post-meta-divider">|</span>
        <!-- <span id="busuanzi_container_site_uv">
          æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
        </span> -->
        <span class="post-count">å…¨ç«™å…± 377.6k å­—</span>
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </div>
  </div> 
</footer>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>
<script src="/blog/js/bootstrap.js"></script>
<script src="/blog/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?bb74e3da22205cadfa4f6e0a31a76ac4";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>
    


  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/blog/js/totop.js" async=""></script>
</body>
</html>
