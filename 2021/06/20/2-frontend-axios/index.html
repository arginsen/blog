<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="google-site-verification" content="OcsZXBpQqAp8163-20wn3epncmCv_UBtqBLZmspy-NA">
  
  <title>ğŸ”¥ æºç  | axios | Arginsen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="HTTPaxiossourcecodebrowser">
  
  
  
  
  <meta name="keywords" content="HTTP,axios,sourcecode,browser">
<meta property="og:type" content="article">
<meta property="og:title" content="ğŸ”¥ æºç  | axios">
<meta property="og:url" content="https://lixupeng.cn/blog/2021/06/20/2-frontend-axios/index.html">
<meta property="og:site_name" content="Arginsen&#39;s Blog">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://lixupeng.cn/blog/img/sourcecode.jpg">
<meta property="og:updated_time" content="2025-07-31T17:58:18.146Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ğŸ”¥ æºç  | axios">
<meta name="twitter:image" content="https://lixupeng.cn/blog/img/sourcecode.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Arginsen&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/blog/css/images/favicon.ico">
  
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="https://fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/blog/css/style.css">

  <script src="/blog/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/blog/css/bootstrap.css">
  <link rel="stylesheet" href="/blog/css/fashion.css">
  <link rel="stylesheet" href="/blog/css/glyphs.css">

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  



<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/blog/" title="Arginsen&#39;s Blog" rel="home"> Arginsen&#39;s Blog </a>
            
          </h1>
          
          
            <div class="site-description">smells like teen spirit</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/">é¦–é¡µ</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/archives">å½’æ¡£</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/categories">åˆ†ç±»</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/about">å…³äº</a> </li>
                    
              </ul>
            </div>
          </nav>
      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-2-frontend-axios" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/blog/img/sourcecode.jpg" rel="gallery_cmeclz8el009jmtpujczr1que">
        <img src="/blog/img/sourcecode.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ğŸ”¥ æºç  | axios
    </h1>
  

      </header>
    

    <div class="article-entry" itemprop="articleBody">
      
        <p><br><br><a id="more"></a></p>
<h1 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h1><p><code>axios</code> æ‰“åŒ…åæœ‰ <code>sourcemap</code> æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½ã€è§£å‹ï¼Œå­¦ä¹ æºç ç”¨äº† 0.19.0 ç‰ˆæœ¬</span><br><span class="line">https://github.com/axios/axios/archive/refs/tags/v0.19.0.zip</span><br><span class="line"></span><br><span class="line">è¿›å…¥ç›®å½•ã€å®‰è£…è¿è¡Œ</span><br><span class="line">npm install</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æŸ¥çœ‹ <code>package.json</code> æ–‡ä»¶ï¼Œ<code>npm start</code> è¿è¡Œçš„æ˜¯ <code>/sandbox/server.js</code>ï¼Œé€šè¿‡ <code>node</code> å‘å¸ƒåœ¨ 3000 ç«¯å£ï¼Œæµè§ˆå™¨æ‰“å¼€ <code>http://localhost:3000</code>ï¼Œå¯ä»¥æµè§ˆå™¨æ‰“æ–­ç‚¹æŸ¥çœ‹<code>axios</code>è¿è¡Œæµç¨‹æ˜¯æ€æ ·çš„ï¼Œä¸€èˆ¬çœ‹è¿™ä¸ªå°±å¯ã€‚</p>
<p>æ­¤å¤–ï¼Œæºç ç›®å½•ä¸­ <code>examples</code> ç›®å½•ä¸‹æœ‰å·²ç»å†™å¥½çš„ä¾‹å­ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚ä¸‹è¾¹åšä¸€äº›å¿…è¦çš„ä¿®æ”¹ï¼Œæ³¨é‡Šæ‰åŸæœ‰çš„å¯æœåŠ¡çš„ä»£ç ï¼Œæ–°æ·»å¦‚ä¸‹ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./examples/server.js</span></span><br><span class="line"></span><br><span class="line">server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = req.url;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// // Process axios itself</span></span><br><span class="line">  <span class="comment">// if (/axios\.min\.js$/.test(url)) &#123;</span></span><br><span class="line">  <span class="comment">//   pipeFileToResponse(res, '../dist/axios.min.js', 'text/javascript');</span></span><br><span class="line">  <span class="comment">//   return;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// if (/axios\.min\.map$/.test(url)) &#123;</span></span><br><span class="line">  <span class="comment">//   pipeFileToResponse(res, '../dist/axios.min.map', 'text/javascript');</span></span><br><span class="line">  <span class="comment">//   return;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// if (/axios\.amd\.min\.js$/.test(url)) &#123;</span></span><br><span class="line">  <span class="comment">//   pipeFileToResponse(res, '../dist/axios.amd.min.js', 'text/javascript');</span></span><br><span class="line">  <span class="comment">//   return;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// if (/axios\.amd\.min\.map$/.test(url)) &#123;</span></span><br><span class="line">  <span class="comment">//   pipeFileToResponse(res, '../dist/axios.amd.min.map', 'text/javascript');</span></span><br><span class="line">  <span class="comment">//   return;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¿®æ”¹æ–¹ä¾¿è°ƒè¯• -------------------</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/axios\.min\.js$/</span>.test(url)) &#123;</span><br><span class="line">    pipeFileToResponse(res, <span class="string">'../dist/axios.js'</span>, <span class="string">'text/javascript'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/axios\.map$/</span>.test(url)) &#123;</span><br><span class="line">    pipeFileToResponse(res, <span class="string">'../dist/axios.map'</span>, <span class="string">'text/javascript'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// -------------------------------</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹å¥½åç›´æ¥è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run examples</span><br><span class="line"></span><br><span class="line">node ./examples/server.js -p 5000 // æˆ–ç›´æ¥æŒ‡å®šç«¯å£</span><br></pre></td></tr></table></figure>
<h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><h2 id="å®ä¾‹ç»“æ„"><a href="#å®ä¾‹ç»“æ„" class="headerlink" title="å®ä¾‹ç»“æ„"></a>å®ä¾‹ç»“æ„</h2><p>åœ¨è¿è¡Œäº† <code>/sandbox/server.js</code> ä¹‹åï¼Œæµè§ˆå™¨æ‰“å¼€ <code>http://localhost:3000</code>ï¼Œåœ¨è°ƒè¯•å™¨ä¸­å¯ä»¥ç›´æ¥æ‰“å° <code>axios</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(&#123;<span class="attr">axios</span>: axios&#125;);</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  axios: Æ’ wrap()</span><br><span class="line">    Axios: Æ’ Axios(instanceConfig)</span><br><span class="line">    Cancel: Æ’ Cancel(message)</span><br><span class="line">    CancelToken: Æ’ CancelToken(executor)</span><br><span class="line">    all: Æ’ all(promises)</span><br><span class="line">    create: Æ’ create(instanceConfig)</span><br><span class="line">    <span class="keyword">default</span>: Æ’ wrap()</span><br><span class="line">    defaults: &#123;<span class="attr">transformRequest</span>: <span class="built_in">Array</span>(<span class="number">1</span>), <span class="attr">transformResponse</span>: <span class="built_in">Array</span>(<span class="number">1</span>), <span class="attr">timeout</span>: <span class="number">0</span>, <span class="attr">xsrfCookieName</span>: <span class="string">"XSRF-TOKEN"</span>, <span class="attr">adapter</span>: Æ’, â€¦&#125;</span><br><span class="line">    <span class="keyword">delete</span>: Æ’ wrap()</span><br><span class="line">    <span class="keyword">get</span>: Æ’ wrap()</span><br><span class="line">    getUri: Æ’ wrap()</span><br><span class="line">    head: Æ’ wrap()</span><br><span class="line">    interceptors: &#123;request: InterceptorManager, <span class="attr">response</span>: InterceptorManager&#125;</span><br><span class="line">    isCancel: Æ’ isCancel(value)</span><br><span class="line">    options: Æ’ wrap()</span><br><span class="line">    patch: Æ’ wrap()</span><br><span class="line">    post: Æ’ wrap()</span><br><span class="line">    put: Æ’ wrap()</span><br><span class="line">    request: Æ’ wrap()</span><br><span class="line">    spread: Æ’ spread(callback)</span><br><span class="line">    <span class="built_in">arguments</span>: (...)</span><br><span class="line">    caller: (...)</span><br><span class="line">    length: <span class="number">0</span></span><br><span class="line">    name: <span class="string">"wrap"</span></span><br><span class="line">    prototype: &#123;<span class="attr">constructor</span>: Æ’&#125;</span><br><span class="line">    __proto__: Æ’ ()</span><br><span class="line">    [[FunctionLocation]]: bind.js:<span class="number">5</span></span><br><span class="line">    [[Scopes]]: Scopes[<span class="number">2</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>axios</code> æœ¬èº«ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„ä½ç½®åœ¨ <code>bind.js</code>ï¼Œè¿™æ˜¯å› ä¸º <code>axios</code> åœ¨åˆ›å»ºæ—¶ï¼Œæ˜¯é€šè¿‡ <code>Axios</code> æ„é€ å‡½æ•°å…ˆç”Ÿæˆå®ä¾‹ï¼Œæ¥ç€ä½¿ç”¨ <code>bind</code> æ–¹æ³•å°† <code>Axios</code> åŸå‹ä¸Šçš„ <code>request</code> æ–¹æ³•çš„ <code>this</code> æŒ‡å‘åˆšç”Ÿæˆçš„æ–°å®ä¾‹ï¼ˆ<code>context</code>ï¼‰ï¼Œå¹¶è¿”å› <code>request</code> å‡½æ•°ï¼Œè€Œ<code>bind</code> åˆè¿”å› <code>wrap</code> å‡½æ•°ï¼Œå³ <code>axios</code> å®é™…ä¸Šå°±æ˜¯è¢«ç»‘åœ¨æ–°å®ä¾‹ä¸‹çš„ <code>request</code> å‡½æ•°</p>
<p>é™¤ä½œä¸ºä¸€ä¸ªå‡½æ•°æœ¬èº«æ‰€æœ‰çš„ <code>argumentsã€callerã€lengthã€nameã€__proto__</code> å±æ€§ï¼Œéšååœ¨ç»‘å®šå®Œ <code>request</code> åï¼Œåˆå¯¹å®ä¾‹ï¼ˆæŒ‡å‘æ–°å®ä¾‹çš„<code>request</code>å‡½æ•°ï¼‰è¿›è¡Œæ‰©å±•ï¼Œå°† <code>Axios</code> åŸå‹ä¸Šçš„å±æ€§éƒ½å¤åˆ¶åˆ° <code>instance</code> ä¸Šï¼›å¹¶ä¸” <code>Axios</code> åŸå‹ä¸Šçš„æ–¹æ³• <code>this</code> å‡æŒ‡å‘ <code>context</code>ï¼ˆåŒä¹‹å‰çš„<code>bind</code>ï¼‰ï¼›æ¥ç€åˆæ‰©å±• <code>instance</code>ï¼Œå°† <code>Axios</code> ä¼ é€’äº†é»˜è®¤è®¾ç½®çš„æ–°å®ä¾‹çš„å±æ€§éƒ½å¤åˆ¶åˆ° <code>instance</code> ä¸Šï¼Œæœ€ç»ˆè¿”å› <code>instance</code>ã€‚</p>
<p>æ‰€ä»¥ <code>axios</code> å¯¹è±¡æœ¬èº«å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ‹¥æœ‰å¾ˆå¤šå±æ€§çš„å‡½æ•°ã€‚</p>
<h2 id="æºç ç»“æ„"><a href="#æºç ç»“æ„" class="headerlink" title="æºç ç»“æ„"></a>æºç ç»“æ„</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">-examples</span><br><span class="line">-lib</span><br><span class="line">  -adapters</span><br><span class="line">    -http.js nodeç¯å¢ƒä¸‹httpè¯·æ±‚é€‚é…å™¨</span><br><span class="line">    -README.md</span><br><span class="line">    -xhr.js æµè§ˆå™¨ç¯å¢ƒXMLHttpReqå¯¹è±¡é€‚é…å™¨</span><br><span class="line">  -cancel å–æ¶ˆè¯·æ±‚</span><br><span class="line">    -Cancel.js æ„é€ å‡½æ•°Cancelï¼Œcancelå¯¹è±¡æ˜¯è¯·æ±‚è¢«å–æ¶ˆæ—¶æŠ›å‡ºçš„å¯¹è±¡</span><br><span class="line">    -CancelToken.js æ„é€ å‡½æ•°CancelTokenï¼Œç”¨äºå–æ¶ˆè¯·æ±‚çš„å¯¹è±¡</span><br><span class="line">    -isCancel.js åˆ¤æ–­è¯·æ±‚å¤±è´¥æ—¶çš„é”™è¯¯å¯¹è±¡æ˜¯å¦æ˜¯Cancelå¯¹è±¡</span><br><span class="line">  -core</span><br><span class="line">    -Axios æ„é€ å‡½æ•°Axiosï¼ŒAxios.prototype.requestæ–¹æ³•</span><br><span class="line">    -createError.js åˆ›å»ºä¸€ä¸ªerrorå¯¹è±¡</span><br><span class="line">    -dispatchRequest.js ä½¿ç”¨å¯¹åº”ç¯å¢ƒçš„é€‚é…å™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚</span><br><span class="line">    -enhanceError.js ä½¿ç”¨æŒ‡å®šä¿¡æ¯å‡çº§errorå¯¹è±¡</span><br><span class="line">    -InterceptorManager.js æ„é€ å‡½æ•°InterceptorManagerï¼Œæ‹¦æˆªå™¨</span><br><span class="line">    -mergeConfig.js åˆå¹¶ä¸¤ä¸ªé…ç½®é¡¹ä¸ºä¸€ä¸ªé…ç½®é¡¹</span><br><span class="line">    -README.md</span><br><span class="line">    -settle.js æ ¹æ®å“åº”çŠ¶æ€ç å†³å®špromiseçš„çŠ¶æ€</span><br><span class="line">    -transformData.js è¯·æ±‚ä¹‹å‰æˆ–å“åº”ä¹‹åå¤„ç†dataæˆ–è€…response</span><br><span class="line">  -helpers ååŠ©æ¨¡å—</span><br><span class="line">    -bind.js ç»‘å®šæ–¹æ³•åˆ°æŒ‡å®šthisä¸Š</span><br><span class="line">    -buildURL.js å°†paramsæŸ¥è¯¢å­—ç¬¦ä¸²è¿æ¥åˆ°urlä¹‹å</span><br><span class="line">    -combineURLs.js è¿æ¥æŒ‡å®šçš„ur1åˆ›å»ºå‡ºæ–°çš„url</span><br><span class="line">    -cookies.js è¯»å†™ã€ç§»é™¤æµè§ˆå™¨cookie</span><br><span class="line">    -deprecatedMethod.js å‘ä¸èµæˆçš„æ–¹æ³•å‘å‡ºè­¦å‘Š</span><br><span class="line">    -isAbsoluteURL.js æ£€æŸ¥urlæ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„</span><br><span class="line">    -isURLSameOrigin.js è¯·æ±‚urlå’Œå½“å‰é¡µé¢åœ°å€æ˜¯å¦å¤„äºåŒä¸€åŸŸ</span><br><span class="line">    -normalizeHeaderName.js æ ‡å‡†åŒ–headerå</span><br><span class="line">    -parseHeaders.js å°†è¯·æ±‚å¤´æˆ–å“åº”å¤´è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡</span><br><span class="line">    -README.md</span><br><span class="line">    -spread.js å°†ä¸€ä¸ªå‡½æ•°åŒ…è£…æˆæ¥æ”¶ä¸€ä¸ªæ•°ç»„å‚æ•°å¹¶å°†å…¶å±•å¼€æˆå‚æ•°åˆ—è¡¨çš„å‡½æ•°</span><br><span class="line">  axios.js å…¥å£ï¼Œåˆ›å»ºaxioså¯¹è±¡</span><br><span class="line">  defaults.js é»˜è®¤é…ç½®</span><br><span class="line">  utils.js å·¥å…·æ–¹æ³•</span><br><span class="line">-sandbox</span><br><span class="line">-test</span><br></pre></td></tr></table></figure>
<h2 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h2><p>æºç å…¥å£ï¼Œä¸€èˆ¬ <code>package.json</code> ä¼šç”³æ˜ <code>main</code> ä¸»å…¥å£æ–‡ä»¶; è®²è§£å†…å®¹å‡åœ¨ <code>lib</code> æ–‡ä»¶å¤¹ä¸‹</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"axios"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.19.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"Promise based HTTP client for the browser and node.js"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒçº§ç›®å½•ä¸‹ <code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'./lib/axios'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="axios-js"><a href="#axios-js" class="headerlink" title="axios.js"></a>axios.js</h3><p>å¦‚ä¸Šä»‹ç»çš„ï¼Œè¯¥æ–‡ä»¶ä¸»è¦ç”¨äºåˆ›å»º <code>axios</code> å®ä¾‹ï¼Œå®é™…ä¸Šåšäº†å¦‚ä¸‹äº‹ï¼š</p>
<ol>
<li>é€šè¿‡ <code>Axios</code> æ„é€ å‡½æ•°ç”Ÿæˆé»˜è®¤é…ç½®çš„å®ä¾‹ <code>context</code></li>
<li>ä½¿ç”¨ <code>bind</code> æ–¹æ³•å°† <code>Axios</code> åŸå‹ä¸Šçš„ <code>request</code> æ–¹æ³•çš„ <code>this</code> æŒ‡å‘åˆšç”Ÿæˆçš„æ–°å®ä¾‹ï¼ˆ<code>context</code>ï¼‰ï¼Œè¿”å› <code>request</code> å‡½æ•°ï¼Œèµ‹ç»™ <code>instance</code></li>
<li>æ¥ç€ç”¨ <code>extend</code> æ–¹æ³•æ‰©å±• <code>instance</code>ï¼Œå°† <code>Axios</code> åŸå‹ä¸Šçš„å±æ€§éƒ½å¤åˆ¶åˆ° <code>instance</code> ä¸Šï¼Œå¹¶å°†å…¶ä¸Šæ–¹æ³•çš„ <code>this</code> å‡æŒ‡å‘ <code>context</code></li>
<li>ç»§ç»­å°† <code>context</code> å¯¹è±¡å¤åˆ¶åˆ° <code>instance</code> ä¸Šï¼Œè¿”å› <code>instance</code>ï¼Œè‡³æ­¤ <code>axios</code> åˆå§‹åŒ–å®ä¾‹çš„æ­¥éª¤è·‘å®Œ</li>
</ol>
<ol start="5">
<li>æ¥ç€å°† <code>Axios</code> æ„é€ å‡½æ•°æ·»åŠ åˆ° <code>axios</code> ä¸Š</li>
<li>åˆ›å»ºå·¥å‚æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨æˆ·è‡ªå®šä¹‰é…ç½®æ¥åˆ›å»º <code>axios</code> å®ä¾‹</li>
<li>ç»‘å®šå–æ¶ˆè¯·æ±‚çš„æ–¹æ³•</li>
<li>ç»‘å®š <code>all</code> å’Œ <code>spread</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/axios.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>);</span><br><span class="line"><span class="keyword">var</span> bind = <span class="built_in">require</span>(<span class="string">'./helpers/bind'</span>);</span><br><span class="line"><span class="keyword">var</span> Axios = <span class="built_in">require</span>(<span class="string">'./core/Axios'</span>);</span><br><span class="line"><span class="keyword">var</span> mergeConfig = <span class="built_in">require</span>(<span class="string">'./core/mergeConfig'</span>);</span><br><span class="line"><span class="keyword">var</span> defaults = <span class="built_in">require</span>(<span class="string">'./defaults'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create an instance of Axios</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>defaultConfig The default config for the instance</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Axios&#125;</span> </span>A new instance of Axios</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createInstance</span>(<span class="params">defaultConfig</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context = <span class="keyword">new</span> Axios(defaultConfig);</span><br><span class="line">  <span class="keyword">var</span> instance = bind(Axios.prototype.request, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy axios.prototype to instance</span></span><br><span class="line">  utils.extend(instance, Axios.prototype, context);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy context to instance</span></span><br><span class="line">  utils.extend(instance, context);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the default instance to be exported</span></span><br><span class="line"><span class="keyword">var</span> axios = createInstance(defaults);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Expose Axios class to allow class inheritance</span></span><br><span class="line">axios.Axios = Axios;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Factory for creating new instances</span></span><br><span class="line">axios.create = <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">instanceConfig</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createInstance(mergeConfig(axios.defaults, instanceConfig));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Expose Cancel &amp; CancelToken</span></span><br><span class="line">axios.Cancel = <span class="built_in">require</span>(<span class="string">'./cancel/Cancel'</span>);</span><br><span class="line">axios.CancelToken = <span class="built_in">require</span>(<span class="string">'./cancel/CancelToken'</span>);</span><br><span class="line">axios.isCancel = <span class="built_in">require</span>(<span class="string">'./cancel/isCancel'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Expose all/spread</span></span><br><span class="line">axios.all = <span class="function"><span class="keyword">function</span> <span class="title">all</span>(<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.all(promises);</span><br><span class="line">&#125;;</span><br><span class="line">axios.spread = <span class="built_in">require</span>(<span class="string">'./helpers/spread'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = axios;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Allow use of default import syntax in TypeScript</span></span><br><span class="line"><span class="built_in">module</span>.exports.default = axios;</span><br></pre></td></tr></table></figure>
<h4 id="bind-js"><a href="#bind-js" class="headerlink" title="bind.js"></a>bind.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/helpers/bind.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">bind</span>(<span class="params">fn, thisArg</span>) </span>&#123; <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå¯¹è±¡ï¼Œä½¿å‡½æ•°ä¸­çš„thisæŒ‡å‘è¯¥å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">wrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="built_in">arguments</span>.length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">      args[i] = <span class="built_in">arguments</span>[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fn.apply(thisArg, args); <span class="comment">// å½“å‰çš„axioså®ä¾‹ä¸‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°çš„å‚æ•°argsï¼ˆæ•°ç»„ã€ç±»æ•°ç»„ï¼‰ä½œä¸ºapplyæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼›å‡½æ•°fnçš„thisæŒ‡å‘ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå¯¹è±¡ï¼‰</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="utils-js"><a href="#utils-js" class="headerlink" title="utils.js"></a>utils.js</h4><p><code>lib/utils.js</code>ã€‚å°è£…ä¸€äº›å·¥å…·å‡½æ•°</p>
<h5 id="utils-extend"><a href="#utils-extend" class="headerlink" title="utils.extend"></a>utils.extend</h5><p>éå†å‚æ•° b å¯¹è±¡ï¼Œå¤åˆ¶åˆ° a å¯¹è±¡ä¸Šï¼Œå¦‚æœæ˜¯å‡½æ•°å°±å°† b çš„å±æ€§æ–¹æ³•ç”¨ <code>bind</code> å‡½æ•°å¤„ç†ä¸€é(<code>this</code> æŒ‡å‘å¯¹è±¡ c)ï¼Œå†å¤åˆ¶åˆ° a å¯¹è±¡</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">a, b, thisArg</span>) </span>&#123;</span><br><span class="line">  forEach(b, <span class="function"><span class="keyword">function</span> <span class="title">assignValue</span>(<span class="params">val, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (thisArg &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">'function'</span>) &#123;</span><br><span class="line">      a[key] = bind(val, thisArg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[key] = val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="utils-forEach"><a href="#utils-forEach" class="headerlink" title="utils.forEach"></a>utils.forEach</h5><p>éå†æ•°ç»„å’Œå¯¹è±¡ã€‚è®¾è®¡æ¨¡å¼å«è¿­ä»£å™¨æ¨¡å¼ã€‚<br>ä¸»è¦å®ç°ï¼šåˆ¤æ–­æ˜¯å¦æ•°ç»„æˆ–å¯¹è±¡ï¼Œæ˜¯æ•°ç»„å°±ç”¨ <code>for</code> å¾ªç¯éå†å„å…ƒç´ ï¼Œæ˜¯å¯¹è±¡å°± <code>for...in</code> éå†å±æ€§ã€‚å¾ªç¯æ‰§è¡Œå‚æ•°å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object|Array&#125;</span> </span>obj The object to iterate</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fn The callback to invoke for each item</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">obj, fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Don't bother if no value provided</span></span><br><span class="line">  <span class="comment">// åˆ¤æ–­ null å’Œ undefined ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Force an array if not already something iterable</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œæ”¾åœ¨æ•°ç»„é‡Œã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="comment">/*eslint no-param-reassign:0*/</span></span><br><span class="line">    obj = [obj];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ˜¯æ•°ç»„ åˆ™ç”¨ for å¾ªç¯ï¼Œè°ƒç”¨ fn å‡½æ•°ã€‚å‚æ•°ç±»ä¼¼ Array.prototype.forEach çš„å‰ä¸‰ä¸ªå‚æ•°ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (isArray(obj)) &#123;</span><br><span class="line">    <span class="comment">// Iterate over array values</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = obj.length; i &lt; l; i++) &#123;</span><br><span class="line">      fn.call(<span class="literal">null</span>, obj[i], i, obj);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Iterate over object keys</span></span><br><span class="line">    <span class="comment">// ç”¨ for in éå†å¯¹è±¡ï¼Œä½† for in ä¼šéå†åŸå‹é“¾ä¸Šå¯éå†çš„å±æ€§ã€‚</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥ç”¨ hasOwnProperty æ¥è¿‡æ»¤è‡ªèº«å±æ€§äº†ã€‚</span></span><br><span class="line">    <span class="comment">// å…¶å®ä¹Ÿå¯ä»¥ç”¨ Object.keys æ¥éå†ï¼Œå®ƒä¸éå†åŸå‹é“¾ä¸Šä¸å¯éå†çš„å±æ€§ã€‚</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(obj, key)) &#123;</span><br><span class="line">        fn.call(<span class="literal">null</span>, obj[key], key, obj);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="spread-js"><a href="#spread-js" class="headerlink" title="spread.js"></a>spread.js</h4><p><code>spread(callback)(arr)</code><br><code>spread</code> å‡½æ•°ä¼ å…¥å‚æ•° <code>callback</code>(å›è°ƒå‡½æ•°)ï¼Œå¹¶è¿”å› <code>wrap</code> å‡½æ•°ï¼Œ<code>wrap</code> å‡½æ•°å‚æ•°ä¸ºæ•°ç»„ <code>arr</code>ï¼Œè¿”å› <code>this</code> æŒ‡å‘ <code>null</code> ï¼Œå‚æ•°ä¸º <code>arr</code> çš„å›è°ƒå‡½æ•° <code>callback</code> æ‰§è¡Œç»“æœ</p>
<blockquote>
<p>invoking a function and expanding an array for arguments</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/helpers/spread.js</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Syntactic sugar for invoking a function and expanding an array for arguments.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Common use case would be to use `Function.prototype.apply`.</span></span><br><span class="line"><span class="comment"> * -----------------------</span></span><br><span class="line"><span class="comment"> *  function f(x, y, z) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *  var args = [1, 2, 3];</span></span><br><span class="line"><span class="comment"> *  f.apply(null, args);</span></span><br><span class="line"><span class="comment"> * -----------------------</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * With `spread` this example can be re-written.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> <span class="variable">callback</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Function&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">spread</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">wrap</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callback.apply(<span class="literal">null</span>, arr);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Axios-js"><a href="#Axios-js" class="headerlink" title="Axios.js"></a>Axios.js</h3><ol>
<li>å®šä¹‰äº† <code>Axios</code> æ„é€ å‡½æ•°ï¼Œç»‘å®šäº†ä¼ å…¥çš„é…ç½®ï¼ˆåˆå§‹åŒ–ä¸ºé»˜è®¤é…ç½®ï¼‰å’Œæ‹¦æˆªå™¨</li>
<li>åœ¨æ„é€ å‡½æ•° <code>Axios</code> åŸå‹ä¸Šå®šä¹‰è¯·æ±‚å‡½æ•° <code>request</code>ï¼Œåˆå§‹åŒ–å®Œæˆçš„ <code>axios</code> æœ¬è´¨ä¸Šå°±æ˜¯ <code>request</code> å‡½æ•°ï¼Œåœ¨ä½¿ç”¨æ—¶æˆ‘ä»¬ä¸€èˆ¬ä¼šä¼ å…¥è‡ªå®šçš„é…ç½®ï¼ˆ<code>urlã€timeout</code>ç­‰ï¼‰ï¼Œå› æ­¤ <code>request</code> å‡½æ•°é¦–å…ˆè¦å¤„ç†ä¼ å…¥çš„é…ç½®ï¼Œå…è®¸å­—ç¬¦ä¸²æˆ–å¯¹è±¡ï¼Œå†ä¸é»˜è®¤é…ç½®åˆå¹¶èµ‹å€¼ç»™ <code>config</code>ã€‚å†ç”Ÿæˆä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œ<code>resolve(config)</code></li>
<li>åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ä¸­é—´ä»¶ <code>chain</code>ï¼Œå…ˆå‹å…¥ <code>dispatchRequest</code> å’Œ <code>undefined</code>ï¼Œå†éå†ç”¨æˆ·è®¾ç½®çš„æ‹¦æˆªå™¨ï¼Œå‘ <code>chain</code> å¾ªç¯å‹å…¥æ¯ä¸ªæ‹¦æˆªå™¨ <code>interceptor</code> çš„ <code>fulfilled</code> å’Œ <code>rejected</code> æ–¹æ³•ï¼Œè¯·æ±‚çš„ä»å‰å‹å…¥ï¼Œå“åº”çš„ä»åå‹å…¥ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®Œå chain çš„ç»“æ„å¦‚ä¸‹</span></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">10</span>)</span><br><span class="line"><span class="number">0</span>: Æ’ (config)</span><br><span class="line"><span class="number">1</span>: Æ’ (error)</span><br><span class="line"><span class="number">2</span>: Æ’ (config)</span><br><span class="line"><span class="number">3</span>: Æ’ (error)</span><br><span class="line"><span class="number">4</span>: Æ’ dispatchRequest(config)</span><br><span class="line"><span class="number">5</span>: <span class="literal">undefined</span></span><br><span class="line"><span class="number">6</span>: Æ’ (config)</span><br><span class="line"><span class="number">7</span>: Æ’ (error)</span><br><span class="line"><span class="number">8</span>: Æ’ (config)</span><br><span class="line"><span class="number">9</span>: Æ’ (error)</span><br><span class="line">length: <span class="number">10</span></span><br><span class="line">__proto__: <span class="built_in">Array</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>æ¥ç€å¾ªç¯å–å‡º <code>chain</code>ï¼Œç”±ä¹‹å‰ç”Ÿæˆçš„ <code>promise</code> å¯¹è±¡é“¾å¼è°ƒç”¨ï¼Œæ¯æ¬¡ä» <code>chain</code> å¤´éƒ¨å–ä¸¤ä¸ªï¼Œä½œä¸º <code>promise</code> çš„ <code>then</code> æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°å‡½æ•°(success, error)ï¼Œå¦‚æœä¸€è·¯æ­£å¸¸ï¼Œåœ¨æ‰§è¡Œè¯·æ±‚æ‹¦æˆªå™¨çš„æ“ä½œåŒæ—¶ï¼Œ<code>config</code> ä¹Ÿè¢«ä½œä¸ºå‚æ•°ã€è¿”å›å€¼ä¸€è·¯ä¼ é€’ï¼Œç›´åˆ° <code>dispatchRequest</code> æ‰§è¡Œï¼Œå®Œæˆå…·ä½“çš„æ´¾å‘è¯·æ±‚ï¼Œè·å–å“åº”ç»“æœï¼Œç»è¿‡å“åº”æ‹¦æˆªå™¨å¤„ç†ï¼Œæœ€ç»ˆè¿”å›å“åº”ç»“æœ</li>
<li><code>Axios</code> åŸå‹ä¸Šç»‘å®šäº† <code>getUri</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å°† <code>url</code> åœ°å€ä¸ä¼ çš„å‚æ•°æ‹¼æ¥ï¼Œä¸€èˆ¬ <code>post</code> æ¥å£å‚æ•°ä¸ºå¯¹è±¡æˆ–åµŒå¥—å¯¹è±¡ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°†å…¶æå–å‡ºï¼Œæ‹¼è´´åœ¨ <code>url</code> åè¾¹ï¼Œå½¢æˆä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼çš„ <code>url</code></li>
<li><code>Axios</code> åŸå‹ä¸Šç»‘å®šå„ä¸ªè¯·æ±‚æ–¹æ³•ï¼ŒæŒ‰ä¼ ä¸ä¼ æ•°æ®åˆ†äº†ä¸¤ç»„ï¼Œæœ¬è´¨è¿˜æ˜¯æ•´åˆ <code>config</code> è°ƒç”¨ <code>request</code> æ–¹æ³•</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">'./../utils'</span>);</span><br><span class="line"><span class="keyword">var</span> buildURL = <span class="built_in">require</span>(<span class="string">'../helpers/buildURL'</span>);</span><br><span class="line"><span class="keyword">var</span> InterceptorManager = <span class="built_in">require</span>(<span class="string">'./InterceptorManager'</span>);</span><br><span class="line"><span class="keyword">var</span> dispatchRequest = <span class="built_in">require</span>(<span class="string">'./dispatchRequest'</span>);</span><br><span class="line"><span class="keyword">var</span> mergeConfig = <span class="built_in">require</span>(<span class="string">'./mergeConfig'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create a new instance of Axios</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>instanceConfig The default config for the instance</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Axios</span>(<span class="params">instanceConfig</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.defaults = instanceConfig;</span><br><span class="line">  <span class="comment">// è¯·æ±‚æ‹¦æˆªå™¨ã€å“åº”æ‹¦æˆªå™¨</span></span><br><span class="line">  <span class="keyword">this</span>.interceptors = &#123;</span><br><span class="line">    request: <span class="keyword">new</span> InterceptorManager(),</span><br><span class="line">    response: <span class="keyword">new</span> InterceptorManager()</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dispatch a request</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>config The config specific for this request (merged with this.defaults)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Axios.prototype.request = <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*eslint no-param-reassign:0*/</span></span><br><span class="line">  <span class="comment">// Allow for axios('example/url'[, config]) a la fetch API</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> config === <span class="string">'string'</span>) &#123;</span><br><span class="line">    config = <span class="built_in">arguments</span>[<span class="number">1</span>] || &#123;&#125;;</span><br><span class="line">    config.url = <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    config = config || &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  config = mergeConfig(<span class="keyword">this</span>.defaults, config);</span><br><span class="line">  config.method = config.method ? config.method.toLowerCase() : <span class="string">'get'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Hook up interceptors middleware</span></span><br><span class="line">  <span class="keyword">var</span> chain = [dispatchRequest, <span class="literal">undefined</span>];</span><br><span class="line">  <span class="keyword">var</span> promise = <span class="built_in">Promise</span>.resolve(config); <span class="comment">// ç”Ÿæˆpromiseå®ä¾‹ ç­‰ä»·äº new Promise(resolve =&gt; resolve(config))</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†ç”¨æˆ·è®¾ç½®çš„è¯·æ±‚æ‹¦æˆªå™¨ï¼Œå°†æ¯ä¸ªæ‹¦æˆªå™¨çš„æˆåŠŸå¤±è´¥æ–¹æ³•å‹å…¥ chain</span></span><br><span class="line">  <span class="keyword">this</span>.interceptors.request.forEach(<span class="function"><span class="keyword">function</span> <span class="title">unshiftRequestInterceptors</span>(<span class="params">interceptor</span>) </span>&#123;</span><br><span class="line">    chain.unshift(interceptor.fulfilled, interceptor.rejected); <span class="comment">// æ‹¦æˆªå™¨æˆåŠŸçš„å‡½æ•°ã€æ‹¦æˆªå™¨å¤±è´¥çš„å‡½æ•°</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.interceptors.response.forEach(<span class="function"><span class="keyword">function</span> <span class="title">pushResponseInterceptors</span>(<span class="params">interceptor</span>) </span>&#123;</span><br><span class="line">    chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†chainæ•°ç»„ï¼Œæ¯æ¬¡ä»å¤´ç§»é™¤ä¸¤ä¸ªä½œä¸ºthençš„ä¸¤ä¸ªå‚æ•°(success, error)</span></span><br><span class="line">  <span class="comment">// promise é“¾å¼è°ƒç”¨ï¼Œå…ˆæ‰§è¡Œè¯·æ±‚æ‹¦æˆªå™¨çš„å†…å®¹ï¼Œå†æ´¾å‘è¯·æ±‚ï¼Œ</span></span><br><span class="line">  <span class="comment">// æ­¤æ—¶ä¼ å…¥ä¸Šä¸ªå‡½æ•°æˆåŠŸåçš„configä½œä¸º dispatchRequest çš„å‚æ•°ï¼Œ</span></span><br><span class="line">  <span class="comment">// æ‰§è¡Œå®Œåthenè¿”å›é€‚é…å™¨adapterå¤„ç†åçš„å“åº”æ•°æ®ï¼ˆpromiseå¯¹è±¡ï¼‰</span></span><br><span class="line">  <span class="comment">// å†æ‰§è¡Œç›¸åº”æ‹¦æˆªå™¨å‡½æ•°</span></span><br><span class="line">  <span class="keyword">while</span> (chain.length) &#123;</span><br><span class="line">    promise = promise.then(chain.shift(), chain.shift());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Axios.prototype.getUri = <span class="function"><span class="keyword">function</span> <span class="title">getUri</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config = mergeConfig(<span class="keyword">this</span>.defaults, config);</span><br><span class="line">  <span class="keyword">return</span> buildURL(config.url, config.params, config.paramsSerializer).replace(<span class="regexp">/^\?/</span>, <span class="string">''</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Provide aliases for supported request methods</span></span><br><span class="line">utils.forEach([<span class="string">'delete'</span>, <span class="string">'get'</span>, <span class="string">'head'</span>, <span class="string">'options'</span>], <span class="function"><span class="keyword">function</span> <span class="title">forEachMethodNoData</span>(<span class="params">method</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*eslint func-names:0*/</span></span><br><span class="line">  Axios.prototype[method] = <span class="function"><span class="keyword">function</span>(<span class="params">url, config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.request(utils.merge(config || &#123;&#125;, &#123;</span><br><span class="line">      method: method,</span><br><span class="line">      url: url</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">utils.forEach([<span class="string">'post'</span>, <span class="string">'put'</span>, <span class="string">'patch'</span>], <span class="function"><span class="keyword">function</span> <span class="title">forEachMethodWithData</span>(<span class="params">method</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*eslint func-names:0*/</span></span><br><span class="line">  Axios.prototype[method] = <span class="function"><span class="keyword">function</span>(<span class="params">url, data, config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.request(utils.merge(config || &#123;&#125;, &#123;</span><br><span class="line">      method: method,</span><br><span class="line">      url: url,</span><br><span class="line">      data: data</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Axios;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¹Ÿå¯ä»¥åœ¨ <code>chain</code> åˆ›å»ºåï¼Œæ‹¦æˆªå™¨ç»„éå†ä¹‹å‰æ‰‹åŠ¨æ·»åŠ æ‹¦æˆªå™¨ä½œä»¥æµ‹è¯•ï¼š</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------request------success----2'</span>);</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------request------error------2'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------request------success----1'</span>);</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------request------error------1'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------response-----success----1'</span>);</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------response-----error------1'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------response-----success----2'</span>);</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'------response-----error------2'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="interceptorManager-js"><a href="#interceptorManager-js" class="headerlink" title="interceptorManager.js"></a>interceptorManager.js</h3><p>å®šä¹‰äº†æ‹¦æˆªå™¨æ„é€ å‡½æ•°ï¼ŒåŠåœ¨å…¶åŸå‹ä¸Šç»‘å®š <code>use</code>ã€<code>eject</code>ã€<code>forEach</code> æ–¹æ³•ã€‚</p>
<blockquote>
<p>useã€eject æ–¹æ³•ä¸ºç”¨æˆ·ç«¯ä¹¦å†™ï¼Œå¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a request interceptor</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Do something before request is sent</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Do something with request error</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a response interceptor</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class="line">  <span class="comment">// Do something with response data</span></span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class="line">  <span class="comment">// Do something with response error</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// eject æ–¹æ³•ç§»é™¤æ‹¦æˆªå™¨ï¼ˆè‡ªå®šä¹‰æ¡ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> myInterceptor = axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;);</span><br><span class="line">axios.interceptors.request.eject(myInterceptor);</span><br></pre></td></tr></table></figure>
<p><code>use</code> æ–¹æ³•ä¸ºæ–°å¢ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå‚æ•°ä¸ºç”¨æˆ·ä¾§å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°ï¼Œå°†æ­¤ä¸¤ä¸ªå‡½æ•°ç»„æˆä¸€ä¸ªå¯¹è±¡ï¼Œå³ä¸ºä¸€ä¸ªæ‹¦æˆªå™¨ã€‚</p>
<p><code>eject</code> æ–¹æ³•é€šè¿‡ <code>use</code> ç”Ÿæˆçš„æ‹¦æˆªå™¨æ‰€è¿”å›çš„ <code>id</code>ï¼Œåœ¨<strong>æ‹¦æˆªå™¨ç»„</strong> <code>this.handlers</code> ä¸­åˆ é™¤å¯¹åº”çš„æ‹¦æˆªå™¨ï¼ˆä½¿å…¶ä¸º nullï¼‰</p>
<p><code>forEach</code> æ–¹æ³•éå†<strong>æ‹¦æˆªå™¨ç»„</strong> <code>this.handlers</code> ä¸­æ¯ä¸ªä¸ä¸º <code>null</code> çš„æ‹¦æˆªå™¨(interceptor)æ‰§è¡Œå‚æ•°å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/core/InterceptorManager.js</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">'./../utils'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InterceptorManager</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.handlers = []; <span class="comment">// å­˜å‚¨æ‹¦æˆªå™¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Add a new interceptor to the stack</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fulfilled The function to handle `then` for a `Promise`</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>rejected The function to handle `reject` for a `Promise`</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Number&#125;</span> </span>An ID used to remove interceptor later</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">InterceptorManager.prototype.use = <span class="function"><span class="keyword">function</span> <span class="title">use</span>(<span class="params">fulfilled, rejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.handlers.push(&#123;</span><br><span class="line">    fulfilled: fulfilled,</span><br><span class="line">    rejected: rejected</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.handlers.length - <span class="number">1</span>; <span class="comment">// æ–°æ·»åŠ è¿›çš„åšä»¥åºå·æ ‡è®°æ–¹ä¾¿ç§»é™¤</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Remove an interceptor from the stack</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>id The ID that was returned by `use`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">InterceptorManager.prototype.eject = <span class="function"><span class="keyword">function</span> <span class="title">eject</span>(<span class="params">id</span>) </span>&#123; <span class="comment">// é€šè¿‡useè¿”å›çš„æ•°å­—æ¥åˆ é™¤æ•°ç»„ä¸­çš„æ‹¦æˆªå™¨</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.handlers[id]) &#123;</span><br><span class="line">    <span class="keyword">this</span>.handlers[id] = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Iterate over all the registered interceptors</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This method is particularly useful for skipping over any</span></span><br><span class="line"><span class="comment"> * interceptors that may have become `null` calling `eject`.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fn The function to call for each interceptor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">InterceptorManager.prototype.forEach = <span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  utils.forEach(<span class="keyword">this</span>.handlers, <span class="function"><span class="keyword">function</span> <span class="title">forEachHandler</span>(<span class="params">h</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// h ä¸ºæ‹¦æˆªå™¨ç»„éå†åˆ°çš„å½“å‰çš„å…ƒç´ ï¼Œå³æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// è€Œæ­¤å‡½æ•°æœªå®šä¹‰å…¶ä»–å‚æ•°ï¼Œåˆ™é»˜è®¤ä¸ºç¬¬ä¸€ä¸ªå‚æ•° obj[key]</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ‹¦æˆªå™¨æ˜¯å¦ä¸ºç©ºï¼Œè¿‡æ»¤æ‰å·²åˆ é™¤çš„æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="keyword">if</span> (h !== <span class="literal">null</span>) &#123;</span><br><span class="line">      fn(h);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = InterceptorManager;</span><br></pre></td></tr></table></figure>
<h3 id="dispatchRequest-js"><a href="#dispatchRequest-js" class="headerlink" title="dispatchRequest.js"></a>dispatchRequest.js</h3><p>ä½¿ç”¨é…ç½®å¥½çš„é€‚é…å™¨å‘æœåŠ¡å™¨æ´¾å‘è¯·æ±‚ã€‚</p>
<ol>
<li>æ£€æŸ¥è¯·æ±‚å–æ¶ˆæœºåˆ¶æ˜¯å¦è§¦å‘ï¼Œæœ‰çš„è¯å½“å‰æ´¾å‘å°±ç›´æ¥å–æ¶ˆï¼Œä¸å¾€ä¸‹æ‰§è¡Œ</li>
<li>å¦‚æœç”¨æˆ·è®¾ç½®äº† <code>baseUrl</code> ï¼Œå°±å’Œå…·ä½“è¯·æ±‚è°ƒç”¨çš„ç›¸å¯¹ <code>url</code> æ‹¼æ¥ï¼Œä¸€èˆ¬æˆ‘ä»¬å†™ vue é‡Œçš„è¯·æ±‚å¤„ç†å°±æ˜¯è¿™æ ·</li>
<li>æ£€æŸ¥è¯·æ±‚ <code>headers</code>ï¼Œè½¬æ¢è¯·æ±‚æ•°æ®ï¼Œæ‹å¹³ <code>headers</code>ï¼Œå†å°†æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•åˆ é™¤ <code>headers</code></li>
<li>æ·»åŠ é€‚é…å™¨ <code>adapter</code>ï¼Œ<code>dispatchRequest</code> å‡½æ•°å³è¿”å›é€‚é…å™¨<strong>æ‰§è¡Œçš„ç»“æœ</strong>ï¼Œé€‚é…å™¨æ˜¯çœŸæ­£å‘åç«¯å‘é€è¯·æ±‚çš„éƒ¨åˆ†ï¼Œ<code>adapter</code> æœ¬èº«æ˜¯ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œä¼ å…¥ <code>config</code>ï¼Œç»è¿‡å¤„ç†åï¼ŒæˆåŠŸåˆ™è¿”å›å“åº”æ•°æ®ï¼Œå¤±è´¥åˆ™æŠ›å‡ºé”™è¯¯ã€‚ç»è¿‡å¤„ç†åç”¨ <code>then</code> æ¥å—å¤„ç†åçš„ç»“æœï¼Œå†å°†ç»“æœè½¬åŒ–åè¿”å›ï¼Œç”±æˆ‘ä»¬åœ¨å¤–éƒ¨å¤„ç†æœ€ç»ˆå“åº”æ•°æ®çš„è¿™ä¸ª <code>promise</code> å¯¹è±¡ã€‚(å®é™…ä¸Šæ•´ä¸ªæµç¨‹å°±æ˜¯ <code>request</code> å‡½æ•°)<blockquote>
<p>then æ–¹æ³•æ¥å—ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œåˆ†åˆ«æŒ‡å®š resolved çŠ¶æ€å’Œ rejected çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚</p>
</blockquote>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">'/api/getAllProduct'</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ­£å¸¸å¤„ç†å“åº”æ•°æ®</span></span><br><span class="line">  &#125;, (err) =&gt; &#123;</span><br><span class="line">    <span class="comment">// å¯é€‰çš„å›è°ƒå‡½æ•°ï¼Œç”¨äºå¤„ç† rejected çŠ¶æ€</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/core/dispatchRequest.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">'./../utils'</span>);</span><br><span class="line"><span class="keyword">var</span> transformData = <span class="built_in">require</span>(<span class="string">'./transformData'</span>);</span><br><span class="line"><span class="keyword">var</span> isCancel = <span class="built_in">require</span>(<span class="string">'../cancel/isCancel'</span>);</span><br><span class="line"><span class="keyword">var</span> defaults = <span class="built_in">require</span>(<span class="string">'../defaults'</span>);</span><br><span class="line"><span class="keyword">var</span> isAbsoluteURL = <span class="built_in">require</span>(<span class="string">'./../helpers/isAbsoluteURL'</span>);</span><br><span class="line"><span class="keyword">var</span> combineURLs = <span class="built_in">require</span>(<span class="string">'./../helpers/combineURLs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Throws a `Cancel` if cancellation has been requested.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throwIfCancellationRequested</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">    config.cancelToken.throwIfRequested();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Dispatch a request to the server using the configured adapter.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>config The config that is to be used for the request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>The Promise to be fulfilled</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">dispatchRequest</span>(<span class="params">config</span>) </span>&#123; <span class="comment">// æ´¾å‘è¯·æ±‚</span></span><br><span class="line">  throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Support baseURL config</span></span><br><span class="line">  <span class="keyword">if</span> (config.baseURL &amp;&amp; !isAbsoluteURL(config.url)) &#123;</span><br><span class="line">    config.url = combineURLs(config.baseURL, config.url);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ensure headers exist</span></span><br><span class="line">  config.headers = config.headers || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Transform request data</span></span><br><span class="line">  config.data = transformData(</span><br><span class="line">    config.data,</span><br><span class="line">    config.headers,</span><br><span class="line">    config.transformRequest</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Flatten headers</span></span><br><span class="line">  config.headers = utils.merge(</span><br><span class="line">    config.headers.common || &#123;&#125;,</span><br><span class="line">    config.headers[config.method] || &#123;&#125;,</span><br><span class="line">    config.headers || &#123;&#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  utils.forEach(</span><br><span class="line">    [<span class="string">'delete'</span>, <span class="string">'get'</span>, <span class="string">'head'</span>, <span class="string">'post'</span>, <span class="string">'put'</span>, <span class="string">'patch'</span>, <span class="string">'common'</span>],</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">cleanHeaderConfig</span>(<span class="params">method</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">delete</span> config.headers[method];</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> adapter = config.adapter || defaults.adapter;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> adapter(config).then(<span class="function"><span class="keyword">function</span> <span class="title">onAdapterResolution</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Transform response data</span></span><br><span class="line">    response.data = transformData(</span><br><span class="line">      response.data,</span><br><span class="line">      response.headers,</span><br><span class="line">      config.transformResponse</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> <span class="title">onAdapterRejection</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isCancel(reason)) &#123;</span><br><span class="line">      throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Transform response data</span></span><br><span class="line">      <span class="keyword">if</span> (reason &amp;&amp; reason.response) &#123;</span><br><span class="line">        reason.response.data = transformData(</span><br><span class="line">          reason.response.data,</span><br><span class="line">          reason.response.headers,</span><br><span class="line">          config.transformResponse</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="adapters-xhr-js"><a href="#adapters-xhr-js" class="headerlink" title="adapters/xhr.js"></a>adapters/xhr.js</h3><p>é€‚é…å™¨ <code>adapter</code> åœ¨ defaults.js ä¹Ÿå°±æ˜¯é»˜è®¤é…ç½®åˆ›å»ºå®ä¾‹æ—¶è¢«åˆå§‹åŒ–ï¼Œæ ¹æ® <code>XMLHttpRequest</code>ã€<code>process</code> æ¥åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯æµè§ˆå™¨è¿˜æ˜¯ <code>node</code> ç¯å¢ƒï¼Œæ¥åˆ†åˆ«å¼•å…¥ä¸åŒçš„é€‚é…å™¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/defaults.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDefaultAdapter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> adapter;</span><br><span class="line">  <span class="comment">// æ ¹æ® XMLHttpRequest åˆ¤æ–­</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> XMLHttpRequest !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="comment">// For browsers use XHR adapter</span></span><br><span class="line">    adapter = <span class="built_in">require</span>(<span class="string">'./adapters/xhr'</span>);</span><br><span class="line">    <span class="comment">// æ ¹æ® process åˆ¤æ–­</span></span><br><span class="line">  &#125; elseif (<span class="keyword">typeof</span> process !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">Object</span>.prototype.toString.call(process) === <span class="string">'[object process]'</span>) &#123;</span><br><span class="line">    <span class="comment">// For node use HTTP adapter</span></span><br><span class="line">    adapter = <span class="built_in">require</span>(<span class="string">'./adapters/http'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> defaults = &#123;</span><br><span class="line">  adapter: getDefaultAdapter(),</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ¥çœ‹æˆ‘ä»¬ä¸€èˆ¬é‡åˆ°çš„æµè§ˆå™¨è·¨åŸŸè¯·æ±‚ <code>xhr.js</code></p>
<ol>
<li><p>æ•´ä¸ªæ–‡ä»¶è¿”å›ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé€‚é…å™¨ <code>adapter</code> å³æ˜¯ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œ<code>Promise</code> æ„é€ å‡½æ•°ç”¨ <code>dispatchXhrRequest</code> å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°ä¸º <code>resolve</code> å’Œ <code>reject</code> </p>
<blockquote>
<p>Promise æ„é€ å‡½æ•°å®šä¹‰ï¼Œresolve å’Œ reject ä¸ºä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œresolve åœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»</p>
</blockquote>
</li>
<li><p>å‡†å¤‡è¯·æ±‚æ•°æ®ã€è¯·æ±‚å¤´ã€‚åˆ›å»º <code>XMLHttpRequest</code> å¯¹è±¡ï¼Œåˆ¤æ–­ <code>http</code> æˆæƒä¿¡æ¯ã€‚è®¾ç½®è¯·æ±‚ä¿¡æ¯ï¼Œæ„å»º <code>url</code>ï¼Œè®¾ç½®è¯·æ±‚è¶…æ—¶ã€‚<strong>ç›‘å¬</strong>è¯·æ±‚çŠ¶æ€å˜åŒ–(<code>onreadystatechange</code>)ï¼Œå¦‚æœè¯·æ±‚å‡†å¤‡çŠ¶æ€ä¸å¯¹ï¼Œç›´æ¥è¿”å›ï¼Œä» <code>XHR</code> å¯¹è±¡ä¸­æ£€æŸ¥è¿”å›çš„çŠ¶æ€ç åŠè¿”å›ä¿¡æ¯ï¼Œä¸å¯¹ä¹Ÿç›´æ¥ <code>return</code>ã€‚æ¥ç€å°±å‡†å¤‡å“åº”å¤´ã€å“åº”æ•°æ®ï¼Œä» <code>XHR</code> å¯¹è±¡ä¸­æå– <code>response</code> çš„æ•°æ®ï¼Œä½¿ç”¨ <code>settle</code> å¤„ç†å“åº”æ•°æ®ï¼Œç”¨éªŒè¯çŠ¶æ€ç çš„å‡½æ•°æ£€æµ‹ <code>http</code> çŠ¶æ€ç ï¼Œ200~300 ä¹‹é—´çš„ç”¨ <code>resolve</code> ä½¿å¼‚æ­¥æ“ä½œä¾¿æˆåŠŸå¹¶ä¼ é€’å“åº”æ•°æ®å‡ºå»ï¼›ä¹‹å¤–çš„çŠ¶æ€ç å°±ç”¨ <code>reject</code> æŠ›å‡ºé”™è¯¯ï¼ŒåŒæ—¶é™„ä¸Šå“åº”çš„ä¸€äº›ä¿¡æ¯ã€‚æœ€åæ¸…é™¤æ‰ <code>XHR</code> å¯¹è±¡ã€‚</p>
</li>
<li>å…¶æ¬¡<strong>å®šä¹‰</strong> XHR å¯¹è±¡å¤„ç†å¼‚å¸¸çš„æ–¹æ³•ï¼Œ<code>onabort</code> å¤„ç†è¯·æ±‚å–æ¶ˆçš„æƒ…å†µï¼Œ<code>onerror</code> å¤„ç†ç½‘ç»œé”™è¯¯ï¼Œ<code>ontimeout</code> å¤„ç†è¶…æ—¶ã€‚å†æ·»åŠ  <code>xsrf</code> å¤´ï¼Œå„è¯·æ±‚å¤´ï¼›åˆ¤æ–­æ˜¯å¦å…è®¸å¼€å¯ <code>cookie</code>ï¼ŒæŒ‡å®šè·¨åŸŸ <code>Access-Control</code> è¯·æ±‚æ˜¯å¦åº”å¸¦æœ‰æˆæƒä¿¡æ¯ï¼›æ·»åŠ å“åº”ç±»å‹ï¼›å¤„ç†ä¸‹è½½ã€ä¸Šä¼ è¿›åº¦ï¼›å¤„ç†è¯·æ±‚å–æ¶ˆï¼Œåˆ¤æ–­ç”¨æˆ·ä¾§æ˜¯å¦è®¾ç½® <code>cancelToken</code>ï¼Œå¦‚æœ‰åˆ™æ‰§è¡Œå–æ¶ˆæ“ä½œï¼Œå†æŠ›å‡ºå–æ¶ˆä¿¡æ¯ã€‚</li>
<li>ä»¥ä¸Šå·¥ä½œå®Œæˆå<strong>å‘é€</strong>è¯·æ±‚æ•°æ®ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">'./../utils'</span>);</span><br><span class="line"><span class="keyword">var</span> settle = <span class="built_in">require</span>(<span class="string">'./../core/settle'</span>);</span><br><span class="line"><span class="keyword">var</span> buildURL = <span class="built_in">require</span>(<span class="string">'./../helpers/buildURL'</span>);</span><br><span class="line"><span class="keyword">var</span> parseHeaders = <span class="built_in">require</span>(<span class="string">'./../helpers/parseHeaders'</span>);</span><br><span class="line"><span class="keyword">var</span> isURLSameOrigin = <span class="built_in">require</span>(<span class="string">'./../helpers/isURLSameOrigin'</span>);</span><br><span class="line"><span class="keyword">var</span> createError = <span class="built_in">require</span>(<span class="string">'../core/createError'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">xhrAdapter</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">dispatchXhrRequest</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> requestData = config.data;</span><br><span class="line">    <span class="keyword">var</span> requestHeaders = config.headers;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (utils.isFormData(requestData)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> requestHeaders[<span class="string">'Content-Type'</span>]; <span class="comment">// Let the browser set it</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// HTTP basic authentication</span></span><br><span class="line">    <span class="keyword">if</span> (config.auth) &#123;</span><br><span class="line">      <span class="keyword">var</span> username = config.auth.username || <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">var</span> password = config.auth.password || <span class="string">''</span>;</span><br><span class="line">      requestHeaders.Authorization = <span class="string">'Basic '</span> + btoa(username + <span class="string">':'</span> + password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.open(config.method.toUpperCase(), buildURL(config.url, config.params, config.paramsSerializer), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the request timeout in MS</span></span><br><span class="line">    request.timeout = config.timeout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Listen for ready state</span></span><br><span class="line">    request.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="title">handleLoad</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!request || request.readyState !== <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// The request errored out and we didn't get a response, this will be</span></span><br><span class="line">      <span class="comment">// handled by onerror instead</span></span><br><span class="line">      <span class="comment">// With one exception: request that using file: protocol, most browsers</span></span><br><span class="line">      <span class="comment">// will return status as 0 even though it's a successful request</span></span><br><span class="line">      <span class="comment">// æ£€æµ‹ http çŠ¶æ€ç </span></span><br><span class="line">      <span class="keyword">if</span> (request.status === <span class="number">0</span> &amp;&amp; !(request.responseURL &amp;&amp; request.responseURL.indexOf(<span class="string">'file:'</span>) === <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Prepare the response</span></span><br><span class="line">      <span class="keyword">var</span> responseHeaders = <span class="string">'getAllResponseHeaders'</span> <span class="keyword">in</span> request ? parseHeaders(request.getAllResponseHeaders()) : <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">var</span> responseData = !config.responseType || config.responseType === <span class="string">'text'</span> ? request.responseText : request.response;</span><br><span class="line">      <span class="keyword">var</span> response = &#123;</span><br><span class="line">        data: responseData,</span><br><span class="line">        status: request.status,</span><br><span class="line">        statusText: request.statusText,</span><br><span class="line">        headers: responseHeaders,</span><br><span class="line">        config: config,</span><br><span class="line">        request: request</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      settle(resolve, reject, response); <span class="comment">// ç”¨ http çŠ¶æ€ç æ¥å¤„ç†æ•°æ®çš„å»å‘</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Clean up request</span></span><br><span class="line">      request = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle browser request cancellation (as opposed to a manual cancellation)</span></span><br><span class="line">    request.onabort = <span class="function"><span class="keyword">function</span> <span class="title">handleAbort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      reject(createError(<span class="string">'Request aborted'</span>, config, <span class="string">'ECONNABORTED'</span>, request));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Clean up request</span></span><br><span class="line">      request = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle low level network errors</span></span><br><span class="line">    request.onerror = <span class="function"><span class="keyword">function</span> <span class="title">handleError</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Real errors are hidden from us by the browser</span></span><br><span class="line">      <span class="comment">// onerror should only fire if it's a network error</span></span><br><span class="line">      reject(createError(<span class="string">'Network Error'</span>, config, <span class="literal">null</span>, request));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Clean up request</span></span><br><span class="line">      request = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle timeout</span></span><br><span class="line">    request.ontimeout = <span class="function"><span class="keyword">function</span> <span class="title">handleTimeout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      reject(createError(<span class="string">'timeout of '</span> + config.timeout + <span class="string">'ms exceeded'</span>, config, <span class="string">'ECONNABORTED'</span>,</span><br><span class="line">        request));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Clean up request</span></span><br><span class="line">      request = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add xsrf header</span></span><br><span class="line">    <span class="comment">// This is only done if running in a standard browser environment.</span></span><br><span class="line">    <span class="comment">// Specifically not if we're in a web worker, or react-native.</span></span><br><span class="line">    <span class="keyword">if</span> (utils.isStandardBrowserEnv()) &#123;</span><br><span class="line">      <span class="keyword">var</span> cookies = <span class="built_in">require</span>(<span class="string">'./../helpers/cookies'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add xsrf header</span></span><br><span class="line">      <span class="keyword">var</span> xsrfValue = (config.withCredentials || isURLSameOrigin(config.url)) &amp;&amp; config.xsrfCookieName ?</span><br><span class="line">        cookies.read(config.xsrfCookieName) :</span><br><span class="line">        <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (xsrfValue) &#123;</span><br><span class="line">        requestHeaders[config.xsrfHeaderName] = xsrfValue;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add headers to the request</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'setRequestHeader'</span> <span class="keyword">in</span> request) &#123;</span><br><span class="line">      utils.forEach(requestHeaders, <span class="function"><span class="keyword">function</span> <span class="title">setRequestHeader</span>(<span class="params">val, key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> requestData === <span class="string">'undefined'</span> &amp;&amp; key.toLowerCase() === <span class="string">'content-type'</span>) &#123;</span><br><span class="line">          <span class="comment">// Remove Content-Type if data is undefined</span></span><br><span class="line">          <span class="keyword">delete</span> requestHeaders[key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// Otherwise add header to the request</span></span><br><span class="line">          request.setRequestHeader(key, val);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add withCredentials to request if needed</span></span><br><span class="line">    <span class="comment">// withCredentials æ˜¯å¦å…è®¸å¼€å¯cookie ï¼ŒæŒ‡å®šè·¨åŸŸ Access-Control è¯·æ±‚æ˜¯å¦åº”å¸¦æœ‰æˆæƒä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (config.withCredentials) &#123;</span><br><span class="line">      request.withCredentials = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add responseType to request if needed</span></span><br><span class="line">    <span class="keyword">if</span> (config.responseType) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        request.responseType = config.responseType;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// Expected DOMException thrown by browsers not compatible XMLHttpRequest Level 2.</span></span><br><span class="line">        <span class="comment">// But, this can be suppressed for 'json' type as it can be parsed by default 'transformResponse' function.</span></span><br><span class="line">        <span class="keyword">if</span> (config.responseType !== <span class="string">'json'</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle progress if needed</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> config.onDownloadProgress === <span class="string">'function'</span>) &#123;</span><br><span class="line">      request.addEventListener(<span class="string">'progress'</span>, config.onDownloadProgress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Not all browsers support upload events</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> config.onUploadProgress === <span class="string">'function'</span> &amp;&amp; request.upload) &#123;</span><br><span class="line">      request.upload.addEventListener(<span class="string">'progress'</span>, config.onUploadProgress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (config.cancelToken) &#123; <span class="comment">// å¤„ç†å–æ¶ˆ</span></span><br><span class="line">      <span class="comment">// Handle cancellation</span></span><br><span class="line">      config.cancelToken.promise.then(<span class="function"><span class="keyword">function</span> <span class="title">onCanceled</span>(<span class="params">cancel</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        request.abort(); <span class="comment">// å–æ¶ˆè¯·æ±‚</span></span><br><span class="line">        reject(cancel); <span class="comment">// æŠ›å‡ºå–æ¶ˆä¿¡æ¯</span></span><br><span class="line">        <span class="comment">// Clean up request</span></span><br><span class="line">        request = <span class="literal">null</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (requestData === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      requestData = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Send the request</span></span><br><span class="line">    request.send(requestData);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="cancel"><a href="#cancel" class="headerlink" title="cancel"></a>cancel</h3><ol>
<li>åœ¨ <code>dispatchRequest</code> æµç¨‹ä¸­ï¼Œå¤šæ¬¡ç¡®è®¤æ˜¯å¦è¯·æ±‚å·²å–æ¶ˆçš„æ“ä½œï¼Œå¦‚æœ‰è‚¯å®šå°±ä¸å†å¾€ä¸‹æ‰§è¡Œäº†ã€‚</li>
<li>åœ¨é€‚é…å™¨æµç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨è·¨åŸŸè¯·æ±‚å‘é€å‰ï¼Œæ­¤æ—¶æ£€æµ‹ç”¨æˆ·æ˜¯å¦å®šä¹‰å–æ¶ˆè¯·æ±‚ï¼Œå¦‚å–æ¶ˆï¼Œåˆ™é€šè¿‡å·²å¼‚æ­¥å®Œæˆçš„ <code>config.cancelToken.promise</code> çš„å›è°ƒå‡½æ•° <code>onCanceled</code> æ¥æ‰§è¡Œå–æ¶ˆè¯·æ±‚ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">  <span class="comment">// Handle cancellation</span></span><br><span class="line">  config.cancelToken.promise.then(<span class="function"><span class="keyword">function</span> <span class="title">onCanceled</span>(<span class="params">cancel</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.abort(); <span class="comment">// å–æ¶ˆè¯·æ±‚</span></span><br><span class="line">    reject(cancel); <span class="comment">// æŠ›å‡ºå–æ¶ˆä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// Clean up request</span></span><br><span class="line">    request = <span class="literal">null</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­è¿™ä»¥ä¸Šç‰‡æ®µä¸­æ£€æµ‹çš„æ˜¯ <code>config.cancelToken</code>ï¼Œ<code>config</code> å¯¹è±¡ä¸‹çš„ <code>cancelToken</code> å±æ€§æ˜¯åœ¨ <code>mergeConfig</code> çš„è¿‡ç¨‹ä¸­è¢«æ·»åŠ è¿›äº† <code>config</code>ï¼Œæ„æ€ä¹Ÿæ˜¯æš´éœ²å‡ºå»ç”±ç”¨æˆ·ä¾§ä¹¦å†™è¯¥å±æ€§ã€‚</p>
<p>åœ¨ <code>CancelToken.js</code> ä¸­æœ‰æŒ‡å‡ºå¦‚ä¸‹è®¾å®š:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆåˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">const</span> CancelToken = axios.CancelToken;</span><br><span class="line"><span class="keyword">const</span> source = CancelToken.source();</span><br><span class="line">source.cancel(message);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†åœ¨è·¨åŸŸè¯·æ±‚ä¸­å†™å…¥ config</span></span><br><span class="line">axios.get(<span class="string">'/get/server'</span>, &#123;</span><br><span class="line">  cancelToken: source.token</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (axios.isCancel(err)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Request canceled'</span>, err.message);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// handle error</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‚ç…§ä»¥ä¸Šä¹¦å†™ï¼Œå¯ä»¥ç›´æ¥å¯¹ <code>sandbox/client.html</code> çš„ <code>axios</code> è¯·æ±‚æ”¹é€ ç”¨äºå–æ¶ˆæ¨¡å—çš„è°ƒè¯•</p>
</blockquote>
<p>ä»ä¸Šå¾—çŸ¥ï¼Œæˆ‘ä»¬è¦å®šä¹‰å–æ¶ˆè¯·æ±‚çš„æ“ä½œï¼Œå¿…é¡»å…ˆé€šè¿‡ <code>axios.CancelToken</code> ä¸Šå®šä¹‰çš„ <code>source</code> æ–¹æ³•æ¥åˆå§‹åŒ–ï¼Œå†ä¼ å…¥æˆ‘ä»¬æƒ³è¦å–æ¶ˆæ—¶æŠ›å‡ºçš„ä¿¡æ¯ <code>message</code></p>
<h4 id="cancel-CancelToken-js"><a href="#cancel-CancelToken-js" class="headerlink" title="cancel/CancelToken.js"></a>cancel/CancelToken.js</h4><ol>
<li><code>source</code> æ–¹æ³•é¦–å…ˆå®šä¹‰ <code>cancel</code>ï¼Œå†åˆå§‹åŒ– <code>CancelToken</code> å®ä¾‹èµ‹å€¼ç»™ <code>token</code>ï¼ŒåŒæ—¶ä¼ å…¥ä¸€ä¸ªæ‰§è¡Œå™¨å‡½æ•°ï¼Œæ‰§è¡Œå™¨å‡½æ•°çš„å‚æ•°è¢«èµ‹å€¼ç»™ <code>cancel</code>ï¼Œæœ€åå°† <code>cancel</code> å’Œ <code>token</code> å‹å…¥ä¸€ä¸ªå¯¹è±¡è¿”å›ã€‚</li>
<li>å†æ¥çœ‹ <code>CancelToken</code> æ„é€ å‡½æ•°ï¼Œé¦–å…ˆæ£€æµ‹ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºå‡½æ•°ï¼ˆç”¨æˆ·å¯ä»¥ç›´æ¥ä¼ å‚ï¼‰ï¼Œå¦‚ä¸æ˜¯åˆ™æŠ›å‡ºé”™è¯¯ï¼ˆæ¥ä¸Šä¼ å…¥çš„æ˜¯æ‰§è¡Œå™¨å‡½æ•° <code>executor(c)</code>ï¼‰ã€‚</li>
<li>æ¥ç€åˆ›å»ºä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œå°† <code>resolve</code> æƒé™ç§»å‡ºã€‚</li>
<li>å®šä¹‰ <code>token</code> ï¼Œç»™èµ‹å€¼å½“å‰çš„ <code>CancelToken</code> å¯¹è±¡ã€‚</li>
<li>æ‰§è¡Œå™¨å‡½æ•° <code>executor</code> ä¼ å…¥ <code>cancel</code> å‡½æ•°ï¼ˆå‚æ•°ï¼‰ç›´æ¥æ‰§è¡Œï¼Œå‡½æ•°ä½“å†…è¯­å¥å³æ˜¯ <code>cancel = f cancel(message)</code>ï¼Œ<code>source</code> å‡½æ•°ä½“ä¸­çš„ <code>cancel</code> å°±å¯ä»¥åˆ©ç”¨é—­åŒ…çš„åŸç†è·å– <code>CancelToken</code> å‡½æ•°å†…çš„å˜é‡ï¼š<code>token</code>ã€<code>resolvePromise</code>ï¼Œå¹¶å®šä¹‰äº† <code>token.reason</code>ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¿ç•™ <code>CancelToken</code> çš„ <code>this</code>ï¼Œ<code>this.reason</code> è¢«èµ‹å€¼é”™è¯¯ä¿¡æ¯å¯¹è±¡ï¼Œå†å°†ä¹‹å‰çš„ <code>promise</code> å¯¹è±¡è½¬ä¸ºå®ŒæˆçŠ¶æ€ï¼Œå¹¶ä¼ é€’é”™è¯¯ä¿¡æ¯å¯¹è±¡ï¼Œ<strong>ç­‰å¾…é€‚é…å™¨å¼‚æ­¥è¯·æ±‚å‘é€ä¹‹å‰æ£€æµ‹è°ƒç”¨</strong>ã€‚</li>
<li>è‡³æ­¤ <code>CancelToken</code> å®ä¾‹ç”Ÿæˆï¼Œèµ‹å€¼ç»™ <code>token</code>ï¼Œæ­¤æ—¶çš„ <code>token</code> å’Œä¹‹å‰é€šè¿‡é—­åŒ…è·å¾—å€¼çš„ <code>cancel</code> å‡½æ•°åˆå¹¶åˆ°ä¸€ä¸ªå¯¹è±¡è¿”å›ï¼Œå¦‚ä¸‹</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»ºè®®å…ˆæŒ‰ä¸Šæ–¹æ­¥éª¤çœ‹å®Œ CancelToken å‡½æ•°å’Œ CancelToken.source æ–¹æ³•æ•´ä¸ªæµç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const source = CancelToken.source();</span></span><br><span class="line"><span class="comment">// source åˆå§‹åŒ–å®Œæˆåï¼Œç»“æ„ä¸ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  token: &#123;</span><br><span class="line">    promise: newPromise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">      resolve(&#123; <span class="attr">message</span>: message&#125;)</span><br><span class="line">    &#125;),</span><br><span class="line">    reason: &#123; <span class="attr">message</span>: message &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  cancel: <span class="function"><span class="keyword">function</span> <span class="title">cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    token.reason = &#123; <span class="attr">message</span>: message &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šç”¨æˆ·ä¾§åˆå§‹åŒ–æ—¶æ˜¯åˆ†<strong>ä¸¤æ­¥</strong>èµ°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€æ­¥æ‰§è¡Œ source å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> source = axios.CancelToken.source();</span><br><span class="line"><span class="comment">// ç”Ÿæˆå¦‚ä¸‹å¯¹è±¡ï¼šæš‚æ—  reasonï¼Œä¸” resolvePromise ä¹Ÿæœªæ‰§è¡Œ</span></span><br><span class="line">&#123;</span><br><span class="line">  token: &#123;</span><br><span class="line">    promise: newPromise(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">      resolve(&#123; <span class="attr">message</span>: message&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  cancel: <span class="function"><span class="keyword">function</span> <span class="title">cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    token.reason = &#123; <span class="attr">message</span>: message &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ç¬¬äºŒæ­¥</span></span><br><span class="line">source.cancel(message);</span><br><span class="line"><span class="comment">// æ­¤æ—¶ source å¯¹è±¡æ‰å®Œæ•´</span></span><br></pre></td></tr></table></figure>
<p><code>CancelToken.js</code> æ–‡ä»¶æºç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/cancel/CancelToken.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Cancel = <span class="built_in">require</span>(<span class="string">'./Cancel'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A `CancelToken` is an object that can be used to request cancellation of an operation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@class</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>executor The executor function.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CancelToken</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> executor !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'executor must be a function.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> resolvePromise;</span><br><span class="line">  <span class="comment">// promise å¾—åˆ°ä¸€ä¸ª promise å¯¹è±¡ï¼Œ</span></span><br><span class="line">  <span class="comment">// åœ¨è¯·æ±‚ç¡®è®¤ config.cancelToken åç»§ç»­æ‰§è¡Œ thenï¼Œ</span></span><br><span class="line">  <span class="comment">// å¹¶ä¼ é€’å‚æ•° token.reasonï¼Œå®è´¨ä¸Šä¹Ÿå°±æ˜¯å–æ¶ˆçš„ message</span></span><br><span class="line">  <span class="keyword">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">promiseExecutor</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    resolvePromise = resolve;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> token = <span class="keyword">this</span>;</span><br><span class="line">  executor(<span class="function"><span class="keyword">function</span> <span class="title">cancel</span>(<span class="params">message</span>) </span>&#123; <span class="comment">// source() åˆå§‹åŒ–æ—¶æš‚æ—  reasonï¼Œè°ƒç”¨ cancel(m) å </span></span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      <span class="comment">// Cancellation has already been requested</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    token.reason = <span class="keyword">new</span> Cancel(message);</span><br><span class="line">    resolvePromise(token.reason); <span class="comment">// è‡³æ­¤ token new æˆåŠŸäº†ï¼Œsource åˆå§‹åŒ–ä¸­è¿”å›</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Throws a `Cancel` if cancellation has been requested.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CancelToken.prototype.throwIfRequested = <span class="function"><span class="keyword">function</span> <span class="title">throwIfRequested</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.reason) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">this</span>.reason;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns an object that contains a new `CancelToken` and a function that, when called,</span></span><br><span class="line"><span class="comment"> * cancels the `CancelToken`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å–æ¶ˆè¯·æ±‚ config.cancelToken æ˜¯è§¦å‘äº†source.cancel()æ‰ç”Ÿæˆçš„ã€‚</span></span><br><span class="line"><span class="comment">/* const CancelToken = axios.CancelToken;</span></span><br><span class="line"><span class="comment"> * const source = CancelToken.source();</span></span><br><span class="line"><span class="comment"> * source.cancel(message);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">CancelToken.source = <span class="function"><span class="keyword">function</span> <span class="title">source</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cancel;</span><br><span class="line">  <span class="keyword">var</span> token = <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    cancel = c;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    token: token,</span><br><span class="line">    cancel: cancel</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CancelToken;</span><br></pre></td></tr></table></figure>
<h4 id="cancel-Cancel-js"><a href="#cancel-Cancel-js" class="headerlink" title="cancel/Cancel.js"></a>cancel/Cancel.js</h4><p><code>Cancel</code> ä½œä¸ºæ„é€ å‡½æ•°è¢«ç”¨æ¥ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œå­˜å‚¨ä¼ å…¥çš„å–æ¶ˆä¿¡æ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib/cancel/Cancel.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A `Cancel` is an object that is thrown when an operation is canceled.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@class</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string=&#125;</span> </span>message The message.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.message = message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cancel.prototype.toString = <span class="function"><span class="keyword">function</span> <span class="title">toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Cancel'</span> + (<span class="keyword">this</span>.message ? <span class="string">': '</span> + <span class="keyword">this</span>.message : <span class="string">''</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Cancel.prototype.__CANCEL__ = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Cancel;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæ•´ä¸ª <code>axios</code> å¤§çš„æ¡†æ¶æ¢³ç†è¿‡ä¸€éï¼Œå¯¹äºåˆå§‹åŒ–æµç¨‹ï¼Œé‡è¦éƒ¨åˆ†çš„è§¦å‘æµç¨‹å·²è¯¦å°½è¯´æ˜ã€‚æ–‡æ¡£æŒ‰ç…§ä»å¤´è‡³å°¾çš„é¡ºåºä¹¦å†™ï¼Œç›¸ä¿¡åˆ°å°¾å°±å¯ç†è§£ <code>axios</code> çš„æºç </p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>å­¦ä¹  axios æºç æ•´ä½“æ¶æ„-è‹¥å· ï¼š<a href="https://mp.weixin.qq.com/s/GNYpgHo97xml0NxT93dHxQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/GNYpgHo97xml0NxT93dHxQ</a><br>åˆ›å»º axios å¯¹è±¡ ï¼š<a href="https://www.cnblogs.com/hahazexia/p/9994209.html" target="_blank" rel="noopener">https://www.cnblogs.com/hahazexia/p/9994209.html</a></p>

      
    </div>
    <br>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/blog/categories/notes/">notes</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/HTTP/">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/axios/">axios</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/browser/">browser</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/sourcecode/">sourcecode</a></li></ul>

      
	<span class="ico-date"></span>
	<a href="/blog/2021/06/20/2-frontend-axios/" class="article-date">
	  <time datetime="2021-06-20T00:29:00.000Z" itemprop="datePublished">å…­æœˆ 20, 2021</time>
	</a>

      <!-- æ·»åŠ å­—æ•°ç»Ÿè®¡ -->
      
        <span class="ico-fontcount"></span><span class="post-count">6.8kå­—</span>
      
    </footer>
    <!-- æ–‡ç« æ·»åŠ è¯„è®º -->
    
      
    <script defer src="https://unpkg.com/leancloud-storage@4/dist/av-min.js"></script>
    <script defer src='https://unpkg.com/valine@latest/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>

        var notify = 'false' == true ? true : false;
        var verify = 'false' == true ? true : false;
		// è®¾ç½®è½®è¯¢
		const timer = setInterval(() => {
			if (window.Valine && typeof window.Valine === 'function') {
				clearInterval(timer);
				new Valine({
					el: '#vcomments',
					notify: notify,
					verify: verify,
					app_id: 'AJj6aG4cDMBqBIISAr1U53Az-gzGzoHsz',
					app_key: 'bIYBhlht4PSXI4pCWuH7Gnuo',
					placeholder: 'say something bro ~',
					avatar: 'monsterid',
					avatarCDN:'https://cravatar.cn/avatar/',
					visitor: 'true',
                    emojiCDN: '//i0.hdslb.com/bfs/emote/', 
                    // è¡¨æƒ…titleå’Œå›¾ç‰‡æ˜ å°„
                    emojiMaps: {
                        "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
                        "tv_äº²äº²": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
                        "tv_å·ç¬‘": "bb690d4107620f1c15cff29509db529a73aee261.png",
                        "tv_å†è§": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
                        "tv_å†·æ¼ ": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
                        "tv_å‘æ€’": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
                        "tv_å‘è´¢": "34db290afd2963723c6eb3c4560667db7253a21a.png",
                        "tv_å¯çˆ±": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
                        "tv_åè¡€": "09dd16a7aa59b77baa1155d47484409624470c77.png",
                        "tv_å‘†": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
                        "tv_å‘•å": "9f996894a39e282ccf5e66856af49483f81870f3.png",
                        "tv_å›°": "241ee304e44c0af029adceb294399391e4737ef2.png",
                        "tv_åç¬‘": "1f0b87f731a671079842116e0991c91c2c88645a.png",
                        "tv_å¤§ä½¬": "093c1e2c490161aca397afc45573c877cdead616.png",
                        "tv_å¤§å“­": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
                        "tv_å§”å±ˆ": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
                        "tv_å®³ç¾": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
                        "tv_å°´å°¬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
                        "tv_å¾®ç¬‘": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
                        "tv_æ€è€ƒ": "90cf159733e558137ed20aa04d09964436f618a1.png",
                        "tv_æƒŠå“": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
                        // ... æ›´å¤šè¡¨æƒ…
                    }
				});
			}
		}, 1000);
    </script>



    
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2021/06/28/2-frontend-nvm/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          ğŸ’¡ å‰ç«¯ | nvm åŒ…ç®¡ç†å·¥å…·
        
      </div>
    </a>
  
  
    <a href="/blog/2021/05/28/2-frontend-js-sr7/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">å‰ç«¯ | JSæ·±å…¥ | å…«ã€this çš„åŸç†</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#è°ƒè¯•"><span class="nav-number">1.</span> <span class="nav-text">è°ƒè¯•</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æºç "><span class="nav-number">2.</span> <span class="nav-text">æºç </span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ä¾‹ç»“æ„"><span class="nav-number">2.1.</span> <span class="nav-text">å®ä¾‹ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æºç ç»“æ„"><span class="nav-number">2.2.</span> <span class="nav-text">æºç ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æºç è§£æ"><span class="nav-number">2.3.</span> <span class="nav-text">æºç è§£æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#axios-js"><span class="nav-number">2.3.1.</span> <span class="nav-text">axios.js</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bind-js"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">bind.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#utils-js"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">utils.js</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#utils-extend"><span class="nav-number">2.3.1.2.1.</span> <span class="nav-text">utils.extend</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#utils-forEach"><span class="nav-number">2.3.1.2.2.</span> <span class="nav-text">utils.forEach</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#spread-js"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">spread.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Axios-js"><span class="nav-number">2.3.2.</span> <span class="nav-text">Axios.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#interceptorManager-js"><span class="nav-number">2.3.3.</span> <span class="nav-text">interceptorManager.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dispatchRequest-js"><span class="nav-number">2.3.4.</span> <span class="nav-text">dispatchRequest.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#adapters-xhr-js"><span class="nav-number">2.3.5.</span> <span class="nav-text">adapters/xhr.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cancel"><span class="nav-number">2.3.6.</span> <span class="nav-text">cancel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cancel-CancelToken-js"><span class="nav-number">2.3.6.1.</span> <span class="nav-text">cancel/CancelToken.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cancel-Cancel-js"><span class="nav-number">2.3.6.2.</span> <span class="nav-text">cancel/Cancel.js</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">3.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">HOME</a>
  
    <a href="/blog/archives" class="mobile-nav-link">ARCHIVES</a>
  
    <a href="/blog/categories" class="mobile-nav-link">CATEGORIES</a>
  
    <a href="/blog/about" class="mobile-nav-link">ABOUT</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2025 Arginsen&#39;s Blog All Rights Reserved.
      </div>
      <div class="site-credit">
        ID  <a href="https://lixupeng.cn" target="_blank">Arginsen</a>
      </div>
      <br>
      <div class="busuanzi-analytics">
        
        <span id="busuanzi_container_site_pv">
          æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
        </span>
        <span class="post-meta-divider">|</span>
        <!-- <span id="busuanzi_container_site_uv">
          æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
        </span> -->
        <span class="post-count">å…¨ç«™å…± 382.5k å­—</span>
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </div>
  </div> 
</footer>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>
<script src="/blog/js/bootstrap.js"></script>
<script src="/blog/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?bb74e3da22205cadfa4f6e0a31a76ac4";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>
    


  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/blog/js/totop.js" async=""></script>
</body>
</html>
