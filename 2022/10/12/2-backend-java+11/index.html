<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="google-site-verification" content="OcsZXBpQqAp8163-20wn3epncmCv_UBtqBLZmspy-NA">
  
  <title>ğŸŒŸ è¯­è¨€ | Java å¹¶å‘ï¼šçº¿ç¨‹æ±  | Arginsen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="JavaBackend">
  
  
  
  
  <meta name="keywords" content="Java,Backend">
<meta property="og:type" content="article">
<meta property="og:title" content="ğŸŒŸ è¯­è¨€ | Java å¹¶å‘ï¼šçº¿ç¨‹æ± ">
<meta property="og:url" content="https://lixupeng.cn/blog/2022/10/12/2-backend-java+11/index.html">
<meta property="og:site_name" content="Arginsen&#39;s Blog">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://lixupeng.cn/blog/img/java+.jpg">
<meta property="og:updated_time" content="2025-08-10T18:26:23.357Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ğŸŒŸ è¯­è¨€ | Java å¹¶å‘ï¼šçº¿ç¨‹æ± ">
<meta name="twitter:image" content="https://lixupeng.cn/blog/img/java+.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Arginsen&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/blog/css/images/favicon.ico">
  
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="https://fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/blog/css/style.css">

  <script src="/blog/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/blog/css/bootstrap.css">
  <link rel="stylesheet" href="/blog/css/fashion.css">
  <link rel="stylesheet" href="/blog/css/glyphs.css">

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  



<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/blog/" title="Arginsen&#39;s Blog" rel="home"> Arginsen&#39;s Blog </a>
            
          </h1>
          
          
            <div class="site-description">smells like teen spirit</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/">é¦–é¡µ</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/archives">å½’æ¡£</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/categories">åˆ†ç±»</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/blog/about">å…³äº</a> </li>
                    
              </ul>
            </div>
          </nav>
      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-2-backend-java+11" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="/blog/img/java+.jpg" rel="gallery_cmeclz8cd0035mtpupp0ftiq0">
        <img src="/blog/img/java+.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ğŸŒŸ è¯­è¨€ | Java å¹¶å‘ï¼šçº¿ç¨‹æ± 
    </h1>
  

      </header>
    

    <div class="article-entry" itemprop="articleBody">
      
        <p><br><br><a id="more"></a></p>
<p>çº¿ç¨‹æ± æ˜¯ç®¡ç†ä¸€ç³»åˆ—çº¿ç¨‹çš„èµ„æºæ± ï¼Œå…¶æä¾›äº†ä¸€ç§é™åˆ¶å’Œç®¡ç†çº¿ç¨‹èµ„æºçš„æ–¹å¼ã€‚æ¯ä¸ªçº¿ç¨‹æ± è¿˜ç»´æŠ¤ä¸€äº›åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°é‡ã€‚</p>
<h1 id="çº¿ç¨‹æ± çš„å¥½å¤„"><a href="#çº¿ç¨‹æ± çš„å¥½å¤„" class="headerlink" title="çº¿ç¨‹æ± çš„å¥½å¤„"></a>çº¿ç¨‹æ± çš„å¥½å¤„</h1><ul>
<li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡<strong>é‡å¤åˆ©ç”¨</strong>å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li>
<li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½<strong>ç«‹å³æ‰§è¡Œ</strong>ã€‚</li>
<li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œ<strong>ç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§</strong>ã€‚</li>
</ul>
<p>çº¿ç¨‹æ± ä¸€èˆ¬ç”¨äºæ‰§è¡Œå¤šä¸ªä¸ç›¸å…³è”çš„è€—æ—¶ä»»åŠ¡ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡é¡ºåºæ‰§è¡Œï¼Œä½¿ç”¨äº†çº¿ç¨‹æ± çš„è¯å¯è®©å¤šä¸ªä¸ç›¸å…³è”çš„ä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚</p>
<h1 id="Executor-æ¡†æ¶"><a href="#Executor-æ¡†æ¶" class="headerlink" title="Executor æ¡†æ¶"></a>Executor æ¡†æ¶</h1><p>é€šè¿‡ Executor æ¥å¯åŠ¨çº¿ç¨‹æ¯”ä½¿ç”¨ Thread çš„ start æ–¹æ³•æ›´å¥½ï¼Œé™¤äº†æ›´æ˜“ç®¡ç†ï¼Œæ•ˆç‡æ›´å¥½ï¼ˆç”¨çº¿ç¨‹æ± å®ç°ï¼ŒèŠ‚çº¦å¼€é”€ï¼‰å¤–ï¼Œè¿˜æœ‰å…³é”®çš„ä¸€ç‚¹ï¼šæœ‰åŠ©äºé¿å… this é€ƒé€¸é—®é¢˜ï¼ˆæŒ‡åœ¨æ„é€ å‡½æ•°è¿”å›ä¹‹å‰å…¶ä»–çº¿ç¨‹å°±æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œè°ƒç”¨å°šæœªæ„é€ å®Œå…¨çš„å¯¹è±¡çš„æ–¹æ³•å¯èƒ½å¼•å‘ä»¤äººç–‘æƒ‘çš„é”™è¯¯ã€‚ï¼‰</p>
<p>Executor æ¡†æ¶ä¸ä»…åŒ…æ‹¬äº†çº¿ç¨‹æ± çš„ç®¡ç†ï¼Œè¿˜æä¾›äº†çº¿ç¨‹å·¥å‚ã€é˜Ÿåˆ—åŠæ‹’ç»ç­–ç•¥ç­‰</p>
<p>Executor æ¡†æ¶ç»“æ„ä¸»è¦ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼š</p>
<h2 id="ä»»åŠ¡ï¼ˆrunnable-callableï¼‰"><a href="#ä»»åŠ¡ï¼ˆrunnable-callableï¼‰" class="headerlink" title="ä»»åŠ¡ï¼ˆrunnable/callableï¼‰"></a>ä»»åŠ¡ï¼ˆrunnable/callableï¼‰</h2><p>æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„ runnable æ¥å£ æˆ– callable æ¥å£ã€‚runnable æ¥å£æˆ– callable æ¥å£å®ç°ç±»éƒ½å¯ä»¥è¢« ThreadPoolExecutor æˆ– ScheduledThreadPoolExecutor æ‰§è¡Œã€‚Callable åœ¨ Java 1.5 ä¸­å¼•å…¥,ç›®çš„å°±æ˜¯ä¸ºäº†æ¥å¤„ç† Runnable ä¸æ”¯æŒçš„ç”¨ä¾‹ã€‚Runnable æ¥å£ä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼Œä½†æ˜¯ Callable æ¥å£å¯ä»¥ã€‚</p>
<h2 id="ä»»åŠ¡çš„æ‰§è¡Œï¼ˆexecutorï¼‰"><a href="#ä»»åŠ¡çš„æ‰§è¡Œï¼ˆexecutorï¼‰" class="headerlink" title="ä»»åŠ¡çš„æ‰§è¡Œï¼ˆexecutorï¼‰"></a>ä»»åŠ¡çš„æ‰§è¡Œï¼ˆexecutorï¼‰</h2><p>ä»»åŠ¡çš„æ‰§è¡ŒåŒ…æ‹¬ä»»åŠ¡æ‰§è¡Œæœºåˆ¶çš„æ ¸å¿ƒæ¥å£ Executorï¼Œä»¥åŠç»§æ‰¿è‡ª Executor æ¥å£çš„ ExecutorService æ¥å£ã€‚ThreadPoolExecutor å’Œ ScheduledThreadPoolExecutor è¿™ä¸¤ä¸ªå…³é”®ç±»å®ç°äº† ExecutorService æ¥å£ã€‚</p>
<h2 id="å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼ˆfutureï¼‰"><a href="#å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼ˆfutureï¼‰" class="headerlink" title="å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼ˆfutureï¼‰"></a>å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼ˆfutureï¼‰</h2><p>Future æ¥å£ä»¥åŠ Future æ¥å£çš„å®ç°ç±» FutureTask ç±»éƒ½å¯ä»¥ä»£è¡¨<strong>å¼‚æ­¥è®¡ç®—çš„ç»“æœ</strong>ã€‚å½“æˆ‘ä»¬æŠŠ Runnableæ¥å£ æˆ– Callable æ¥å£ çš„å®ç°ç±»<strong>æäº¤</strong>ç»™ ThreadPoolExecutor æˆ– ScheduledThreadPoolExecutor æ‰§è¡Œã€‚ï¼ˆè°ƒç”¨ submit() æ–¹æ³•æ—¶ä¼š<strong>è¿”å›</strong>ä¸€ä¸ª FutureTask å¯¹è±¡ï¼ˆrunnable/callableï¼‰ï¼Œexecute() æ–¹æ³•ç”¨äºæäº¤<strong>ä¸éœ€è¦è¿”å›å€¼</strong>ï¼ˆrunnableï¼‰çš„ä»»åŠ¡ã€‚ï¼‰</p>
<p>ç»¼ä¸Šï¼Œ</p>
<ol>
<li>ä¸»çº¿ç¨‹é¦–å…ˆè¦åˆ›å»ºå®ç° Runnable æˆ–è€… Callable æ¥å£çš„ä»»åŠ¡å¯¹è±¡ã€‚</li>
<li>æŠŠåˆ›å»ºå®Œæˆçš„å®ç° <strong>Runnable/Callable æ¥å£çš„å¯¹è±¡</strong>ç›´æ¥äº¤ç»™ <strong>ExecutorService æ‰§è¡Œ</strong>: ExecutorService.executeï¼ˆRunnable commandï¼‰ï¼‰æˆ–è€…ä¹Ÿå¯ä»¥æŠŠ Runnable å¯¹è±¡æˆ–Callable å¯¹è±¡æäº¤ç»™ ExecutorService æ‰§è¡Œï¼ˆExecutorService.submitï¼ˆRunnable taskï¼‰æˆ– ExecutorService.submitï¼ˆCallable <t> taskï¼‰ï¼‰ã€‚</t></li>
<li>å¦‚æœæ‰§è¡Œ ExecutorService.submitï¼ˆâ€¦ï¼‰ï¼ŒExecutorService å°†è¿”å›ä¸€ä¸ªå®ç° <strong>Future æ¥å£çš„å¯¹è±¡</strong>ï¼ˆå¦‚ä¸Šæ‰€è¯´æ‰§è¡Œ execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«ï¼Œsubmit()ä¼šè¿”å›ä¸€ä¸ª FutureTask å¯¹è±¡ï¼‰ã€‚ç”±äº FutureTask å®ç°äº† Runnableï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»º FutureTaskï¼Œç„¶åç›´æ¥äº¤ç»™ ExecutorService æ‰§è¡Œã€‚</li>
<li>æœ€åï¼Œä¸»çº¿ç¨‹å¯ä»¥æ‰§è¡Œ FutureTask.get()æ–¹æ³•æ¥<strong>ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ</strong>ã€‚ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥æ‰§è¡Œ FutureTask.cancelï¼ˆboolean mayInterruptIfRunningï¼‰æ¥<strong>å–æ¶ˆæ­¤ä»»åŠ¡çš„æ‰§è¡Œ</strong>ã€‚</li>
</ol>
<h1 id="ThreadPoolExecutor-ç±»"><a href="#ThreadPoolExecutor-ç±»" class="headerlink" title="ThreadPoolExecutor ç±»"></a>ThreadPoolExecutor ç±»</h1><h2 id="çº¿ç¨‹æ± å‚æ•°åˆ†æ"><a href="#çº¿ç¨‹æ± å‚æ•°åˆ†æ" class="headerlink" title="çº¿ç¨‹æ± å‚æ•°åˆ†æ"></a>çº¿ç¨‹æ± å‚æ•°åˆ†æ</h2><p>ThreadPoolExecutor ç±»ä¸­æä¾›çš„å››ä¸ªæ„é€ æ–¹æ³•ã€‚å…¶ä¸­ä¸‰ä¸ªéƒ½æ˜¯åœ¨æœ€é•¿çš„æ„é€ æ–¹æ³•çš„åŸºç¡€ä¸Šäº§ç”Ÿã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,//çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,//çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,//å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,//æ—¶é—´å•ä½</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,//ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,//çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler//æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡</span></span></span><br><span class="line"><span class="function"><span class="params">                        )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ThreadPoolExecutor 3 ä¸ªæœ€é‡è¦çš„å‚æ•°ï¼š</p>
<ul>
<li>corePoolSize : ä»»åŠ¡é˜Ÿåˆ—æœªè¾¾åˆ°é˜Ÿåˆ—å®¹é‡æ—¶ï¼Œæœ€å¤§å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚</li>
<li>maximumPoolSize : ä»»åŠ¡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚</li>
<li>workQueue: æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚</li>
<li>ThreadPoolExecutor</li>
</ul>
<p>å…¶ä»–å¸¸è§å‚æ•° :</p>
<ul>
<li>keepAliveTime: çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSize çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† keepAliveTimeæ‰ä¼šè¢«å›æ”¶é”€æ¯ã€‚</li>
<li>unit : keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</li>
<li>threadFactory: executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚ä½¿ç”¨ execute() æ–¹æ³•æ—¶ï¼Œå¼‚å¸¸å¤„ç†éœ€è¦é€šè¿‡è‡ªå®šä¹‰çš„ ThreadFactory ï¼ˆåœ¨çº¿ç¨‹å·¥å‚åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™è®¾ç½®UncaughtExceptionHandlerå¯¹è±¡æ¥ å¤„ç†å¼‚å¸¸ï¼‰æˆ– ThreadPoolExecutor çš„ afterExecute() æ–¹æ³•æ¥å¤„ç†ã€‚</li>
<li>handler :æ‹’ç»ç­–ç•¥ï¼ˆåé¢ä¼šå•ç‹¬è¯¦ç»†ä»‹ç»ä¸€ä¸‹ï¼‰ã€‚</li>
</ul>
<h2 id="ThreadPoolExecutor-æ‹’ç»ç­–ç•¥"><a href="#ThreadPoolExecutor-æ‹’ç»ç­–ç•¥" class="headerlink" title="ThreadPoolExecutor æ‹’ç»ç­–ç•¥"></a>ThreadPoolExecutor æ‹’ç»ç­–ç•¥</h2><p>å¦‚æœå½“å‰åŒæ—¶è¿è¡Œçš„<strong>çº¿ç¨‹æ•°é‡è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡</strong>å¹¶ä¸”<strong>é˜Ÿåˆ—ä¹Ÿå·²ç»è¢«æ”¾æ»¡äº†ä»»åŠ¡</strong>æ—¶ï¼ŒThreadPoolExecutor å®šä¹‰ä¸€äº›ç­–ç•¥:</p>
<ul>
<li>ThreadPoolExecutor.AbortPolicyï¼šæŠ›å‡º RejectedExecutionExceptionæ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚</li>
<li>ThreadPoolExecutor.CallerRunsPolicyï¼šè°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨è°ƒç”¨executeæ–¹æ³•çš„çº¿ç¨‹ä¸­è¿è¡Œ(run)è¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚å› æ­¤è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ è¦æ±‚ä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚éƒ½è¦è¢«æ‰§è¡Œçš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚</li>
<li>ThreadPoolExecutor.DiscardPolicyï¼šä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰ã€‚</li>
<li>ThreadPoolExecutor.DiscardOldestPolicyï¼šæ­¤ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©çš„æœªå¤„ç†çš„ä»»åŠ¡è¯·æ±‚ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼šSpring é€šè¿‡ ThreadPoolTaskExecutor æˆ–è€…æˆ‘ä»¬ç›´æ¥é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ä¸æŒ‡å®š RejectedExecutionHandler æ‹’ç»ç­–ç•¥æ¥é…ç½®çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œ<strong>é»˜è®¤ä½¿ç”¨çš„æ˜¯ AbortPolicy</strong>ã€‚åœ¨è¿™ç§æ‹’ç»ç­–ç•¥ä¸‹ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼ŒThreadPoolExecutor å°†æŠ›å‡º RejectedExecutionException å¼‚å¸¸æ¥æ‹’ç»æ–°æ¥çš„ä»»åŠ¡ ï¼Œè¿™ä»£è¡¨ä½ å°†ä¸¢å¤±å¯¹è¿™ä¸ªä»»åŠ¡çš„å¤„ç†ã€‚å¦‚æœä¸æƒ³ä¸¢å¼ƒä»»åŠ¡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ CallerRunsPolicyã€‚CallerRunsPolicy å’Œå…¶ä»–çš„å‡ ä¸ªç­–ç•¥ä¸åŒï¼Œå®ƒæ—¢ä¸ä¼šæŠ›å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†ä»»åŠ¡<strong>å›é€€ç»™è°ƒç”¨è€…</strong>ï¼Œä½¿ç”¨è°ƒç”¨è€…çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CallerRunsPolicy</span> <span class="keyword">implements</span> <span class="title">RejectedExecutionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CallerRunsPolicy</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                <span class="comment">// ç›´æ¥ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œè€Œä¸æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">                r.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼"><a href="#çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼" class="headerlink" title="çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼"></a>çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼</h2><ul>
<li>é€šè¿‡ ThreadPoolExecutor æ„é€ å‡½æ•°ç›´æ¥åˆ›å»º</li>
<li>é€šè¿‡ Executors å·¥å…·ç±»åˆ›å»º</li>
</ul>
<p>é€šè¿‡ ThreadPoolExecutor æ„é€ å‡½æ•°çš„æ–¹å¼ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œå…è®¸å¼€å‘è€…æ˜ç¡®æŒ‡å®šçº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼Œå¯¹çº¿ç¨‹æ± çš„è¿è¡Œè¡Œä¸ºæœ‰æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œä»è€Œé¿å…èµ„æºè€—å°½çš„é£é™©ã€‚é¿å…ä½¿ç”¨ Executors ç±»åˆ›å»ºçº¿ç¨‹æ± ï¼Œä¼šæœ‰ OOM é£é™©ã€‚</p>
<h2 id="çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æ€»ç»“"><a href="#çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æ€»ç»“" class="headerlink" title="çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æ€»ç»“"></a>çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æ€»ç»“</h2><p>æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚</p>
<p>ä¸åŒçš„çº¿ç¨‹æ± ä¼šé€‰ç”¨ä¸åŒçš„é˜»å¡é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆå†…ç½®çº¿ç¨‹æ± æ¥åˆ†æã€‚</p>
<ul>
<li>å®¹é‡ Integer.MAX_VALUE çš„ LinkedBlockingQueueï¼ˆæ— ç•Œé˜Ÿåˆ—ï¼‰ï¼šFixedThreadPool å’Œ SingleThreadExector ã€‚FixedThreadPool æœ€å¤šåªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ç›¸ç­‰ï¼‰ï¼ŒSingleThreadExector åªèƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½æ˜¯ 1ï¼‰ï¼ŒäºŒè€…çš„ä»»åŠ¡é˜Ÿåˆ—æ°¸è¿œä¸ä¼šè¢«æ”¾æ»¡ã€‚</li>
<li>SynchronousQueueï¼ˆåŒæ­¥é˜Ÿåˆ—ï¼‰ï¼šCachedThreadPool ã€‚SynchronousQueue æ²¡æœ‰å®¹é‡ï¼Œä¸å­˜å‚¨å…ƒç´ ï¼Œç›®çš„æ˜¯<strong>ä¿è¯å¯¹äºæäº¤çš„ä»»åŠ¡</strong>ï¼Œå¦‚æœæœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨ç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼›å¦åˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCachedThreadPool çš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯ Integer.MAX_VALUE ï¼Œå¯ä»¥ç†è§£ä¸ºçº¿ç¨‹æ•°æ˜¯å¯ä»¥æ— é™æ‰©å±•çš„ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</li>
<li>DelayedWorkQueueï¼ˆå»¶è¿Ÿé˜»å¡é˜Ÿåˆ—ï¼‰ï¼šScheduledThreadPool å’Œ SingleThreadScheduledExecutor ã€‚DelayedWorkQueue çš„å†…éƒ¨å…ƒç´ å¹¶ä¸æ˜¯æŒ‰ç…§æ”¾å…¥çš„æ—¶é—´æ’åºï¼Œè€Œæ˜¯ä¼šæŒ‰ç…§å»¶è¿Ÿçš„æ—¶é—´é•¿çŸ­å¯¹ä»»åŠ¡è¿›è¡Œæ’åºï¼Œå†…éƒ¨é‡‡ç”¨çš„æ˜¯â€œå †â€çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡å‡ºé˜Ÿçš„ä»»åŠ¡éƒ½æ˜¯å½“å‰é˜Ÿåˆ—ä¸­æ‰§è¡Œæ—¶é—´æœ€é å‰çš„ã€‚DelayedWorkQueue æ·»åŠ å…ƒç´ æ»¡äº†ä¹‹åä¼šè‡ªåŠ¨æ‰©å®¹åŸæ¥å®¹é‡çš„ 1/2ï¼Œå³<strong>æ°¸è¿œä¸ä¼šé˜»å¡</strong>ï¼Œæœ€å¤§æ‰©å®¹å¯è¾¾ Integer.MAX_VALUEï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ã€‚</li>
</ul>
<h1 id="çº¿ç¨‹æ± åŸç†"><a href="#çº¿ç¨‹æ± åŸç†" class="headerlink" title="çº¿ç¨‹æ± åŸç†"></a>çº¿ç¨‹æ± åŸç†</h1><h2 id="çº¿ç¨‹æ± å®ç°"><a href="#çº¿ç¨‹æ± å®ç°" class="headerlink" title="çº¿ç¨‹æ± å®ç°"></a>çº¿ç¨‹æ± å®ç°</h2><h3 id="MyRunnable-java"><a href="#MyRunnable-java" class="headerlink" title="MyRunnable.java"></a>MyRunnable.java</h3><p>åˆ›å»º Runnable æ¥å£çš„å®ç°ç±»ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ Callable æ¥å£ï¼‰ã€‚Callable ä»…åœ¨ Java 1.5 ä¸­å¼•å…¥,ç›®çš„å°±æ˜¯ä¸ºäº†æ¥å¤„ç† Runnable ä¸æ”¯æŒçš„ç”¨ä¾‹ã€‚Runnable æ¥å£ä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼Œä½†æ˜¯ Callable æ¥å£å¯ä»¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Runnableç±»ï¼Œéœ€è¦å¤§çº¦5ç§’é’Ÿæ¥æ‰§è¡Œå…¶ä»»åŠ¡ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shuang.kou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String command;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyRunnable</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.command = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" Start. Time = "</span> + <span class="keyword">new</span> Date());</span><br><span class="line">        processCommand();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" End. Time = "</span> + <span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processCommand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.command;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ThreadPoolExecutorDemo-java"><a href="#ThreadPoolExecutorDemo-java" class="headerlink" title="ThreadPoolExecutorDemo.java"></a>ThreadPoolExecutorDemo.java</h3><p>ä½¿ç”¨ ThreadPoolExecutor æ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°çš„æ–¹å¼æ¥<strong>åˆ›å»ºçº¿ç¨‹æ± </strong>ã€‚</p>
<p>ç”¨ ThreadPoolExecutor åˆ›å»ºçš„ä»»åŠ¡å¯¹è±¡ executor çš„ execute æ–¹æ³•å¤„ç†ä»»åŠ¡çš„å·¥ä½œçº¿ç¨‹å¯¹è±¡ã€‚</p>
<p><code>ThreadPoolExecutor(...).execute(worker)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolExecutorDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CORE_POOL_SIZE = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_POOL_SIZE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> QUEUE_CAPACITY = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Long KEEP_ALIVE_TIME = <span class="number">1L</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼</span></span><br><span class="line">        <span class="comment">//é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º</span></span><br><span class="line">        ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">                CORE_POOL_SIZE,</span><br><span class="line">                MAX_POOL_SIZE,</span><br><span class="line">                KEEP_ALIVE_TIME,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(QUEUE_CAPACITY),</span><br><span class="line">                <span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºWorkerThreadå¯¹è±¡ï¼ˆWorkerThreadç±»å®ç°äº†Runnable æ¥å£ï¼‰</span></span><br><span class="line">            Runnable worker = <span class="keyword">new</span> MyRunnable(<span class="string">""</span> + i);</span><br><span class="line">            <span class="comment">//æ‰§è¡ŒRunnable</span></span><br><span class="line">            executor.execute(worker);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å˜ä¸º SHUTDOWNï¼Œé˜Ÿåˆ—é‡Œä»»åŠ¡ä¼šæ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">        executor.shutdown();</span><br><span class="line">        <span class="keyword">while</span> (!executor.isTerminated()) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Finished all threads"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹å®šä¹‰äº†ï¼š</p>
<p>corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5<br>maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•° 10<br>keepAliveTime : ç­‰å¾…æ—¶é—´ä¸º 1L<br>unit: ç­‰å¾…æ—¶é—´çš„å•ä½ä¸º TimeUnit.SECONDS<br>workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ä¸º ArrayBlockingQueueï¼Œå¹¶ä¸”å®¹é‡ä¸º 100<br>handler: æ‹’ç»ç­–ç•¥ä¸º CallerRunsPolicy</p>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pool-1-thread-3 Start. Time = Sun Apr 12 11:14:37 CST 2020</span><br><span class="line">pool-1-thread-5 Start. Time = Sun Apr 12 11:14:37 CST 2020</span><br><span class="line">pool-1-thread-2 Start. Time = Sun Apr 12 11:14:37 CST 2020</span><br><span class="line">pool-1-thread-1 Start. Time = Sun Apr 12 11:14:37 CST 2020</span><br><span class="line">pool-1-thread-4 Start. Time = Sun Apr 12 11:14:37 CST 2020</span><br><span class="line">pool-1-thread-3 End. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-4 End. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-1 End. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-5 End. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-1 Start. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-2 End. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-5 Start. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-4 Start. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-3 Start. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-2 Start. Time = Sun Apr 12 11:14:42 CST 2020</span><br><span class="line">pool-1-thread-1 End. Time = Sun Apr 12 11:14:47 CST 2020</span><br><span class="line">pool-1-thread-4 End. Time = Sun Apr 12 11:14:47 CST 2020</span><br><span class="line">pool-1-thread-5 End. Time = Sun Apr 12 11:14:47 CST 2020</span><br><span class="line">pool-1-thread-3 End. Time = Sun Apr 12 11:14:47 CST 2020</span><br><span class="line">pool-1-thread-2 End. Time = Sun Apr 12 11:14:47 CST 2020</span><br><span class="line">Finished all threads</span><br></pre></td></tr></table></figure>
<p>çº¿ç¨‹æ± é¦–å…ˆä¼šå…ˆæ‰§è¡Œ 5 ä¸ªä»»åŠ¡ï¼Œç„¶åè¿™äº›ä»»åŠ¡æœ‰ä»»åŠ¡è¢«æ‰§è¡Œå®Œçš„è¯ï¼Œå°±ä¼šå»æ‹¿æ–°çš„ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œäº†æ‰ä¼šè·³å‡ºæ¥ï¼Œå› ä¸º executor.isTerminated() åˆ¤æ–­ä¸º true äº†æ‰ä¼šè·³å‡º while å¾ªç¯ï¼Œå½“ä¸”ä»…å½“è°ƒç”¨ shutdown() æ–¹æ³•åï¼Œå¹¶ä¸”æ‰€æœ‰æäº¤çš„ä»»åŠ¡å®Œæˆåè¿”å›ä¸º true</p>
<h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><p>åœ¨ä¸Šè¾¹ ThreadPoolExecutorDemo æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ execute() å»åˆ›å»º</p>
<h3 id="execute"><a href="#execute" class="headerlink" title="execute()"></a>execute()</h3><p>ä½¿ç”¨ executor.execute(worker)æ¥æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­å»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜æ”¾çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger ctl = <span class="keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">workerCountOf</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> c &amp; CAPACITY;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// å¦‚æœä»»åŠ¡ä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">     <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">     <span class="comment">// ctl ä¸­ä¿å­˜çš„çº¿ç¨‹æ± å½“å‰çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">     <span class="keyword">int</span> c = ctl.get();</span><br><span class="line"></span><br><span class="line">     <span class="comment">//  ä¸‹é¢ä¼šæ¶‰åŠåˆ° 3 æ­¥ æ“ä½œ</span></span><br><span class="line">     <span class="comment">// 1.é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äº corePoolSize</span></span><br><span class="line">     <span class="comment">// å¦‚æœå°äºçš„è¯ï¼Œé€šè¿‡addWorker(command, true)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚</span></span><br><span class="line">     <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">         <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">             <span class="keyword">return</span>;</span><br><span class="line">         c = ctl.get();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// 2.å¦‚æœå½“å‰æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡å¤§äºç­‰äº corePoolSize çš„æ—¶å€™å°±ä¼šèµ°åˆ°è¿™é‡Œï¼Œè¡¨æ˜åˆ›å»ºæ–°çš„çº¿ç¨‹å¤±è´¥ã€‚</span></span><br><span class="line">     <span class="comment">// é€šè¿‡ isRunning æ–¹æ³•åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ï¼Œçº¿ç¨‹æ± å¤„äº RUNNING çŠ¶æ€å¹¶ä¸”é˜Ÿåˆ—å¯ä»¥åŠ å…¥ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æ‰ä¼šè¢«åŠ å…¥è¿›å»</span></span><br><span class="line">     <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">         <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">         <span class="comment">// å†æ¬¡è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ RUNNING çŠ¶æ€å°±éœ€è¦ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span></span><br><span class="line">         <span class="keyword">if</span> (!isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">             reject(command);</span><br><span class="line">             <span class="comment">// å¦‚æœå½“å‰å·¥ä½œçº¿ç¨‹æ•°é‡ä¸º0ï¼Œæ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">             addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">//3. é€šè¿‡addWorker(command, false)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚</span></span><br><span class="line">     <span class="comment">// ä¼ å…¥ false ä»£è¡¨å¢åŠ çº¿ç¨‹æ—¶åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å°‘äº maxPoolSize</span></span><br><span class="line">     <span class="comment">//å¦‚æœaddWorker(command, false)æ‰§è¡Œå¤±è´¥ï¼Œåˆ™é€šè¿‡reject()æ‰§è¡Œç›¸åº”çš„æ‹’ç»ç­–ç•¥çš„å†…å®¹ã€‚</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">         reject(command);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°<strong>å°äº</strong>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå°±ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°<strong>ç­‰äºæˆ–å¤§äº</strong>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä½†æ˜¯<strong>å°äº</strong>æœ€å¤§çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå°±æŠŠè¯¥ä»»åŠ¡æ”¾å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—é‡Œ<strong>ç­‰å¾…</strong>æ‰§è¡Œã€‚</li>
<li>å¦‚æœå‘ä»»åŠ¡é˜Ÿåˆ—æŠ•æ”¾ä»»åŠ¡å¤±è´¥ï¼ˆä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡äº†ï¼‰ï¼Œä½†æ˜¯å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°æ˜¯å°äºæœ€å¤§çº¿ç¨‹æ•°çš„ï¼Œå°±<strong>æ–°å»º</strong>ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å·²ç»ç­‰åŒäºæœ€å¤§çº¿ç¨‹æ•°äº†ï¼Œæ–°å»ºçº¿ç¨‹å°†ä¼šä½¿å½“å‰è¿è¡Œçš„çº¿ç¨‹è¶…å‡ºæœ€å¤§çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå½“å‰ä»»åŠ¡ä¼šè¢«<strong>æ‹’ç»</strong>ï¼Œæ‹’ç»ç­–ç•¥ä¼šè°ƒç”¨RejectedExecutionHandler.rejectedExecution()æ–¹æ³•ã€‚</li>
</ol>
<h3 id="addWorker"><a href="#addWorker" class="headerlink" title="addWorker()"></a>addWorker()</h3><p>addWorker è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥åˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœè¿”å› true è¯´æ˜åˆ›å»ºå’Œå¯åŠ¨å·¥ä½œçº¿ç¨‹æˆåŠŸï¼Œå¦åˆ™çš„è¯è¿”å›çš„å°±æ˜¯ falseã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// å…¨å±€é”ï¼Œå¹¶å‘æ“ä½œå¿…å¤‡</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"> <span class="comment">// è·Ÿè¸ªçº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ï¼Œåªæœ‰åœ¨æŒæœ‰å…¨å±€é”mainLockçš„å‰æä¸‹æ‰èƒ½è®¿é—®æ­¤é›†åˆ</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">int</span> largestPoolSize;</span><br><span class="line"> <span class="comment">// å·¥ä½œçº¿ç¨‹é›†åˆï¼Œå­˜æ”¾çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„ï¼ˆæ´»è·ƒçš„ï¼‰å·¥ä½œçº¿ç¨‹ï¼Œåªæœ‰åœ¨æŒæœ‰å…¨å±€é”mainLockçš„å‰æä¸‹æ‰èƒ½è®¿é—®æ­¤é›†åˆ</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> HashSet&lt;Worker&gt; workers = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"> <span class="comment">//è·å–çº¿ç¨‹æ± çŠ¶æ€</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">runStateOf</span><span class="params">(<span class="keyword">int</span> c)</span>     </span>&#123; <span class="keyword">return</span> c &amp; ~CAPACITY; &#125;</span><br><span class="line"> <span class="comment">//åˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦ä¸º Running</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isRunning</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> c &lt; SHUTDOWN;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ·»åŠ æ–°çš„å·¥ä½œçº¿ç¨‹åˆ°çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> firstTask è¦æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> coreå‚æ•°ä¸ºtrueçš„è¯è¡¨ç¤ºä½¿ç”¨çº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼Œä¸ºfalseä½¿ç”¨çº¿ç¨‹æ± æœ€å¤§å¤§å°</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> æ·»åŠ æˆåŠŸå°±è¿”å›trueå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>&#123;</span><br><span class="line">     retry:</span><br><span class="line">     <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">         <span class="comment">//è¿™ä¸¤å¥ç”¨æ¥è·å–çº¿ç¨‹æ± çš„çŠ¶æ€</span></span><br><span class="line">         <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">         <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">         <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class="line">             ! (rs == SHUTDOWN &amp;&amp;</span><br><span class="line">                firstTask == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                ! workQueue.isEmpty()))</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">//è·å–çº¿ç¨‹æ± ä¸­å·¥ä½œçš„çº¿ç¨‹çš„æ•°é‡</span></span><br><span class="line">             <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">             <span class="comment">// coreå‚æ•°ä¸ºfalseçš„è¯è¡¨æ˜é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œçº¿ç¨‹æ± å¤§å°å˜ä¸º maximumPoolSize</span></span><br><span class="line">             <span class="keyword">if</span> (wc &gt;= CAPACITY ||</span><br><span class="line">                 wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">//åŸå­æ“ä½œå°†workcountçš„æ•°é‡åŠ 1</span></span><br><span class="line">             <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                 <span class="keyword">break</span> retry;</span><br><span class="line">             <span class="comment">// å¦‚æœçº¿ç¨‹çš„çŠ¶æ€æ”¹å˜äº†å°±å†æ¬¡æ‰§è¡Œä¸Šè¿°æ“ä½œ</span></span><br><span class="line">             c = ctl.get();</span><br><span class="line">             <span class="keyword">if</span> (runStateOf(c) != rs)</span><br><span class="line">                 <span class="keyword">continue</span> retry;</span><br><span class="line">             <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// æ ‡è®°å·¥ä½œçº¿ç¨‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">     <span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line">     <span class="comment">// æ ‡è®°å·¥ä½œçº¿ç¨‹æ˜¯å¦åˆ›å»ºæˆåŠŸ</span></span><br><span class="line">     <span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">     Worker w = <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">         w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">         <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">         <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="comment">// åŠ é”</span></span><br><span class="line">             <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">             mainLock.lock();</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//è·å–çº¿ç¨‹æ± çŠ¶æ€</span></span><br><span class="line">                 <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line">                <span class="comment">//rs &lt; SHUTDOWN å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¾ç„¶ä¸ºRUNNING,å¹¶ä¸”çº¿ç¨‹çš„çŠ¶æ€æ˜¯å­˜æ´»çš„è¯ï¼Œå°±ä¼šå°†å·¥ä½œçº¿ç¨‹æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆä¸­</span></span><br><span class="line">               <span class="comment">//(rs=SHUTDOWN &amp;&amp; firstTask == null)å¦‚æœçº¿ç¨‹æ± çŠ¶æ€å°äºSTOPï¼Œä¹Ÿå°±æ˜¯RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€ä¸‹ï¼ŒåŒæ—¶ä¼ å…¥çš„ä»»åŠ¡å®ä¾‹firstTaskä¸ºnullï¼Œåˆ™éœ€è¦æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆå’Œå¯åŠ¨æ–°çš„Worker</span></span><br><span class="line">                <span class="comment">// firstTask == nullè¯æ˜åªæ–°å»ºçº¿ç¨‹è€Œä¸æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                 <span class="keyword">if</span> (rs &lt; SHUTDOWN ||</span><br><span class="line">                     (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) &#123;</span><br><span class="line">                     <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                     workers.add(w);</span><br><span class="line">                    <span class="comment">//æ›´æ–°å½“å‰å·¥ä½œçº¿ç¨‹çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">                     <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                     <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                         largestPoolSize = s;</span><br><span class="line">                   <span class="comment">// å·¥ä½œçº¿ç¨‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">                     workerAdded = <span class="keyword">true</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                 <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                 mainLock.unlock();</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="comment">//// å¦‚æœæˆåŠŸæ·»åŠ å·¥ä½œçº¿ç¨‹ï¼Œåˆ™è°ƒç”¨Workerå†…éƒ¨çš„çº¿ç¨‹å®ä¾‹tçš„Thread#start()æ–¹æ³•å¯åŠ¨çœŸå®çš„çº¿ç¨‹å®ä¾‹</span></span><br><span class="line">             <span class="keyword">if</span> (workerAdded) &#123;</span><br><span class="line">                 t.start();</span><br><span class="line">               <span class="comment">/// æ ‡è®°çº¿ç¨‹å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">                 workerStarted = <span class="keyword">true</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹å¯åŠ¨å¤±è´¥ï¼Œéœ€è¦ä»å·¥ä½œçº¿ç¨‹ä¸­ç§»é™¤å¯¹åº”çš„Worker</span></span><br><span class="line">         <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">             addWorkerFailed(w);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> workerStarted;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æ•´ä¸ªçº¿ç¨‹æ± çš„æµç¨‹å³æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­æ¨¡æ‹Ÿäº† 10 ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬é…ç½®çš„æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5ã€ç­‰å¾…é˜Ÿåˆ—å®¹é‡ä¸º 100 ï¼Œæ‰€ä»¥æ¯æ¬¡åªå¯èƒ½å­˜åœ¨ 5 ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œå‰©ä¸‹çš„ 5 ä¸ªä»»åŠ¡ä¼šè¢«æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­å»ã€‚å½“å‰çš„ 5 ä¸ªä»»åŠ¡ä¸­å¦‚æœæœ‰ä»»åŠ¡è¢«æ‰§è¡Œå®Œäº†ï¼Œçº¿ç¨‹æ± å°±ä¼šå»æ‹¿æ–°çš„ä»»åŠ¡æ‰§è¡Œã€‚</p>
<h1 id="çº¿ç¨‹æ± æ³¨æ„äº‹é¡¹"><a href="#çº¿ç¨‹æ± æ³¨æ„äº‹é¡¹" class="headerlink" title="çº¿ç¨‹æ± æ³¨æ„äº‹é¡¹"></a>çº¿ç¨‹æ± æ³¨æ„äº‹é¡¹</h1><ol>
<li><p>çº¿ç¨‹æ± å¿…é¡»æ‰‹åŠ¨é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æ¥å£°æ˜ï¼Œé¿å…ä½¿ç”¨Executors ç±»åˆ›å»ºçº¿ç¨‹æ± ï¼Œä¼šæœ‰ OOM é£é™©ã€‚</p>
</li>
<li><p>å»ºè®®ä¸åŒç±»åˆ«çš„ä¸šåŠ¡ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼Œå› ä¸ºä¸åŒçš„ä¸šåŠ¡çš„å¹¶å‘ä»¥åŠå¯¹èµ„æºçš„ä½¿ç”¨æƒ…å†µéƒ½ä¸åŒï¼Œé‡å¿ƒä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆç›¸å…³çš„ä¸šåŠ¡ã€‚</p>
</li>
<li><p>åˆå§‹åŒ–çº¿ç¨‹æ± çš„æ—¶å€™éœ€è¦<strong>æ˜¾ç¤ºå‘½å</strong>ï¼ˆè®¾ç½®çº¿ç¨‹æ± åç§°å‰ç¼€ï¼‰ï¼Œæœ‰åˆ©äºå®šä½é—®é¢˜ã€‚é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„çº¿ç¨‹åå­—ç±»ä¼¼ pool-1-thread-n è¿™æ ·çš„ï¼Œæ²¡æœ‰ä¸šåŠ¡å«ä¹‰ï¼Œä¸åˆ©äºæˆ‘ä»¬å®šä½é—®é¢˜ã€‚</p>
</li>
<li><p>æ­£ç¡®è®¾ç½®çº¿ç¨‹æ± é…ç½®å‚æ•°ï¼Œå¯¹äº <strong>CPU å¯†é›†å‹ä»»åŠ¡</strong> (N)ï¼Œçº¿ç¨‹æ•°åº”è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰ã€‚ç”±äºä»»åŠ¡ä¸»è¦ç“¶é¢ˆåœ¨äº CPU è®¡ç®—èƒ½åŠ›ï¼Œä¸æ ¸å¿ƒæ•°ç›¸ç­‰çš„çº¿ç¨‹æ•°èƒ½å¤Ÿæœ€å¤§åŒ– CPU åˆ©ç”¨ç‡ï¼Œè¿‡å¤šçº¿ç¨‹åè€Œä¼š<strong>å¯¼è‡´ç«äº‰å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</strong>ã€‚å¯¹äº<strong>I/O å¯†é›†å‹ä»»åŠ¡</strong>(M <em> N)ï¼š è¿™ç±»ä»»åŠ¡å¤§éƒ¨åˆ†æ—¶é—´å¤„ç† I/O äº¤äº’ï¼Œçº¿ç¨‹åœ¨ç­‰å¾… I/O æ—¶ä¸å ç”¨ CPUã€‚ ä¸ºäº†å……åˆ†åˆ©ç”¨ CPU èµ„æºï¼Œçº¿ç¨‹æ•°å¯ä»¥è®¾ç½®ä¸º M </em> Nï¼Œå…¶ä¸­ N æ˜¯ CPU æ ¸å¿ƒæ•°ï¼ŒM æ˜¯ä¸€ä¸ªå¤§äº 1 çš„å€æ•°ï¼Œå»ºè®®é»˜è®¤è®¾ç½®ä¸º 2 ï¼Œå…·ä½“å–å€¼å–å†³äº <strong>I/O ç­‰å¾…æ—¶é—´å’Œä»»åŠ¡ç‰¹ç‚¹</strong>ï¼Œéœ€è¦é€šè¿‡æµ‹è¯•å’Œç›‘æ§æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚</p>
</li>
<li><p>å½“çº¿ç¨‹æ± ä¸å†éœ€è¦ä½¿ç”¨æ—¶ï¼Œåº”è¯¥<strong>æ˜¾å¼åœ°å…³é—­çº¿ç¨‹æ± </strong>ï¼Œé‡Šæ”¾çº¿ç¨‹èµ„æºã€‚è°ƒç”¨å®Œ shutdownNow å’Œ shuwdown æ–¹æ³•åï¼Œå¹¶ä¸ä»£è¡¨çº¿ç¨‹æ± å·²ç»å®Œæˆå…³é—­æ“ä½œï¼Œå®ƒåªæ˜¯<strong>å¼‚æ­¥çš„é€šçŸ¥</strong>çº¿ç¨‹æ± è¿›è¡Œå…³é—­å¤„ç†ã€‚å¦‚æœè¦åŒæ­¥ç­‰å¾…çº¿ç¨‹æ± å½»åº•å…³é—­åæ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œéœ€è¦è°ƒç”¨ awaitTermination æ–¹æ³•è¿›è¡Œ<strong>åŒæ­¥ç­‰å¾…</strong>ã€‚åœ¨è°ƒç”¨ awaitTermination() æ–¹æ³•æ—¶ï¼Œåº”è¯¥è®¾ç½®åˆç†çš„<strong>è¶…æ—¶æ—¶é—´</strong>ï¼Œä»¥é¿å…ç¨‹åºé•¿æ—¶é—´é˜»å¡è€Œå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å¦å¤–ã€‚ç”±äºçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å¯èƒ½ä¼šè¢«å–æ¶ˆæˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤åœ¨ä½¿ç”¨ awaitTermination() æ–¹æ³•æ—¶è¿˜éœ€è¦è¿›è¡Œ<strong>å¼‚å¸¸å¤„ç†</strong>ã€‚awaitTermination() æ–¹æ³•ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ï¼Œéœ€è¦æ•è·å¹¶å¤„ç†è¯¥å¼‚å¸¸ï¼Œä»¥é¿å…ç¨‹åºå´©æºƒæˆ–è€…æ— æ³•æ­£å¸¸é€€å‡ºã€‚</p>
</li>
<li><p>é¿å…å°†<strong>è€—æ—¶ä»»åŠ¡</strong>æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚çº¿ç¨‹æ± æœ¬èº«çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜ä»»åŠ¡æ‰§è¡Œæ•ˆç‡ï¼Œé¿å…å› é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹è€Œå¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚å¦‚æœå°†è€—æ—¶ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¢«é•¿æ—¶é—´å ç”¨ï¼Œæ— æ³•åŠæ—¶å“åº”å…¶ä»–ä»»åŠ¡ï¼Œç”šè‡³ä¼šå¯¼è‡´çº¿ç¨‹æ± å´©æºƒæˆ–è€…ç¨‹åºå‡æ­»ã€‚</p>
</li>
<li><p>çº¿ç¨‹æ± æ˜¯å¯ä»¥<strong>å¤ç”¨</strong>çš„ï¼Œä¸€å®šä¸è¦é¢‘ç¹åˆ›å»ºçº¿ç¨‹æ± æ¯”å¦‚ä¸€ä¸ªç”¨æˆ·è¯·æ±‚åˆ°äº†å°±å•ç‹¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚</p>
</li>
<li><p>ä½¿ç”¨ Spring å†…éƒ¨çº¿ç¨‹æ± æ—¶ï¼Œä¸€å®šè¦<strong>æ‰‹åŠ¨è‡ªå®šä¹‰</strong>çº¿ç¨‹æ± ï¼Œé…ç½®åˆç†çš„å‚æ•°ï¼Œä¸ç„¶ä¼šå‡ºç°ç”Ÿäº§é—®é¢˜ï¼ˆä¸€ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼‰ã€‚</p>
</li>
<li><p>çº¿ç¨‹æ± å’Œ ThreadLocal å…±ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹ä»ThreadLocal è·å–åˆ°çš„æ˜¯<strong>æ—§å€¼/è„æ•°æ®</strong>ã€‚è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ± ä¼š<strong>å¤ç”¨çº¿ç¨‹</strong>å¯¹è±¡ï¼Œä¸çº¿ç¨‹å¯¹è±¡ç»‘å®šçš„ç±»çš„é™æ€å±æ€§ ThreadLocal å˜é‡ä¹Ÿä¼šè¢«é‡ç”¨ï¼Œè¿™å°±å¯¼è‡´ä¸€ä¸ªçº¿ç¨‹å¯èƒ½è·å–åˆ°å…¶ä»–çº¿ç¨‹çš„ ThreadLocal å€¼ã€‚å¸¸ç”¨çš„ Web æœåŠ¡å™¨ <strong>Tomcat</strong> å¤„ç†ä»»åŠ¡ä¸ºäº†æé«˜å¹¶å‘é‡ï¼Œå°±ä½¿ç”¨åˆ°äº†çº¿ç¨‹æ± ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯åŸºäºåŸç”Ÿ <strong>Java çº¿ç¨‹æ± </strong>æ”¹è¿›å®Œå–„å¾—åˆ°çš„è‡ªå®šä¹‰çº¿ç¨‹æ± ã€‚æ‰€ä»¥éœ€ä½¿ç”¨é˜¿é‡Œå·´å·´å¼€æºçš„ TransmittableThreadLocal(TTL)ã€‚TransmittableThreadLocal ç±»ç»§æ‰¿å¹¶åŠ å¼ºäº† JDK å†…ç½®çš„InheritableThreadLocal ç±»ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰ä¼šæ± åŒ–<strong>å¤ç”¨çº¿ç¨‹</strong>çš„æ‰§è¡Œç»„ä»¶æƒ…å†µä¸‹ï¼Œæä¾› <strong>ThreadLocal å€¼çš„ä¼ é€’</strong>åŠŸèƒ½ï¼Œè§£å†³å¼‚æ­¥æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡ä¼ é€’çš„é—®é¢˜ã€‚</p>
</li>
</ol>

      
    </div>
    <br>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/blog/categories/notes/">notes</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Backend/">Backend</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Java/">Java</a></li></ul>

      
	<span class="ico-date"></span>
	<a href="/blog/2022/10/12/2-backend-java+11/" class="article-date">
	  <time datetime="2022-10-11T16:00:00.000Z" itemprop="datePublished">åæœˆ 12, 2022</time>
	</a>

      <!-- æ·»åŠ å­—æ•°ç»Ÿè®¡ -->
      
        <span class="ico-fontcount"></span><span class="post-count">5.7kå­—</span>
      
    </footer>
    <!-- æ–‡ç« æ·»åŠ è¯„è®º -->
    
      
    <script defer src="https://unpkg.com/leancloud-storage@4/dist/av-min.js"></script>
    <script defer src='https://unpkg.com/valine@latest/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>

        var notify = 'false' == true ? true : false;
        var verify = 'false' == true ? true : false;
		// è®¾ç½®è½®è¯¢
		const timer = setInterval(() => {
			if (window.Valine && typeof window.Valine === 'function') {
				clearInterval(timer);
				new Valine({
					el: '#vcomments',
					notify: notify,
					verify: verify,
					app_id: 'AJj6aG4cDMBqBIISAr1U53Az-gzGzoHsz',
					app_key: 'bIYBhlht4PSXI4pCWuH7Gnuo',
					placeholder: 'say something bro ~',
					avatar: 'monsterid',
					avatarCDN:'https://cravatar.cn/avatar/',
					visitor: 'true',
                    emojiCDN: '//i0.hdslb.com/bfs/emote/', 
                    // è¡¨æƒ…titleå’Œå›¾ç‰‡æ˜ å°„
                    emojiMaps: {
                        "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
                        "tv_äº²äº²": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
                        "tv_å·ç¬‘": "bb690d4107620f1c15cff29509db529a73aee261.png",
                        "tv_å†è§": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
                        "tv_å†·æ¼ ": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
                        "tv_å‘æ€’": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
                        "tv_å‘è´¢": "34db290afd2963723c6eb3c4560667db7253a21a.png",
                        "tv_å¯çˆ±": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
                        "tv_åè¡€": "09dd16a7aa59b77baa1155d47484409624470c77.png",
                        "tv_å‘†": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
                        "tv_å‘•å": "9f996894a39e282ccf5e66856af49483f81870f3.png",
                        "tv_å›°": "241ee304e44c0af029adceb294399391e4737ef2.png",
                        "tv_åç¬‘": "1f0b87f731a671079842116e0991c91c2c88645a.png",
                        "tv_å¤§ä½¬": "093c1e2c490161aca397afc45573c877cdead616.png",
                        "tv_å¤§å“­": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
                        "tv_å§”å±ˆ": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
                        "tv_å®³ç¾": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
                        "tv_å°´å°¬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
                        "tv_å¾®ç¬‘": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
                        "tv_æ€è€ƒ": "90cf159733e558137ed20aa04d09964436f618a1.png",
                        "tv_æƒŠå“": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
                        // ... æ›´å¤šè¡¨æƒ…
                    }
				});
			}
		}, 1000);
    </script>



    
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2022/10/27/2-backend-java+12/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          ğŸŒŸ è¯­è¨€ | Java JVMï¼šå†…å­˜åŒºåŸŸ
        
      </div>
    </a>
  
  
    <a href="/blog/2022/09/24/2-backend-java+10/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">ğŸŒŸ è¯­è¨€ | Java å¹¶å‘ï¼šä¹è§‚é”ä¸æ‚²è§‚é”</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#çº¿ç¨‹æ± çš„å¥½å¤„"><span class="nav-number">1.</span> <span class="nav-text">çº¿ç¨‹æ± çš„å¥½å¤„</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Executor-æ¡†æ¶"><span class="nav-number">2.</span> <span class="nav-text">Executor æ¡†æ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»»åŠ¡ï¼ˆrunnable-callableï¼‰"><span class="nav-number">2.1.</span> <span class="nav-text">ä»»åŠ¡ï¼ˆrunnable/callableï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»»åŠ¡çš„æ‰§è¡Œï¼ˆexecutorï¼‰"><span class="nav-number">2.2.</span> <span class="nav-text">ä»»åŠ¡çš„æ‰§è¡Œï¼ˆexecutorï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼ˆfutureï¼‰"><span class="nav-number">2.3.</span> <span class="nav-text">å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼ˆfutureï¼‰</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ThreadPoolExecutor-ç±»"><span class="nav-number">3.</span> <span class="nav-text">ThreadPoolExecutor ç±»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#çº¿ç¨‹æ± å‚æ•°åˆ†æ"><span class="nav-number">3.1.</span> <span class="nav-text">çº¿ç¨‹æ± å‚æ•°åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ThreadPoolExecutor-æ‹’ç»ç­–ç•¥"><span class="nav-number">3.2.</span> <span class="nav-text">ThreadPoolExecutor æ‹’ç»ç­–ç•¥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼"><span class="nav-number">3.3.</span> <span class="nav-text">çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æ€»ç»“"><span class="nav-number">3.4.</span> <span class="nav-text">çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#çº¿ç¨‹æ± åŸç†"><span class="nav-number">4.</span> <span class="nav-text">çº¿ç¨‹æ± åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#çº¿ç¨‹æ± å®ç°"><span class="nav-number">4.1.</span> <span class="nav-text">çº¿ç¨‹æ± å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MyRunnable-java"><span class="nav-number">4.1.1.</span> <span class="nav-text">MyRunnable.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ThreadPoolExecutorDemo-java"><span class="nav-number">4.1.2.</span> <span class="nav-text">ThreadPoolExecutorDemo.java</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸç†åˆ†æ"><span class="nav-number">4.2.</span> <span class="nav-text">åŸç†åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#execute"><span class="nav-number">4.2.1.</span> <span class="nav-text">execute()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#addWorker"><span class="nav-number">4.2.2.</span> <span class="nav-text">addWorker()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#çº¿ç¨‹æ± æ³¨æ„äº‹é¡¹"><span class="nav-number">5.</span> <span class="nav-text">çº¿ç¨‹æ± æ³¨æ„äº‹é¡¹</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">HOME</a>
  
    <a href="/blog/archives" class="mobile-nav-link">ARCHIVES</a>
  
    <a href="/blog/categories" class="mobile-nav-link">CATEGORIES</a>
  
    <a href="/blog/about" class="mobile-nav-link">ABOUT</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2025 Arginsen&#39;s Blog All Rights Reserved.
      </div>
      <div class="site-credit">
        ID  <a href="https://lixupeng.cn" target="_blank">Arginsen</a>
      </div>
      <br>
      <div class="busuanzi-analytics">
        
        <span id="busuanzi_container_site_pv">
          æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
        </span>
        <span class="post-meta-divider">|</span>
        <!-- <span id="busuanzi_container_site_uv">
          æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
        </span> -->
        <span class="post-count">å…¨ç«™å…± 366.2k å­—</span>
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </div>
  </div> 
</footer>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>
<script src="/blog/js/bootstrap.js"></script>
<script src="/blog/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?bb74e3da22205cadfa4f6e0a31a76ac4";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>
    


  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/blog/js/totop.js" async=""></script>
</body>
</html>
